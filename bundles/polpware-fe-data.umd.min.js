!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("polpware-tinymce-tailor/src/util/XHR"),require("polpware-tinymce-tailor/src/util/Tools"),require("polpware-tinymce-tailor/src/util/EventDispatcher"),require("@ngrx/store"),require("@angular/core"),require("polpware-tinymce-tailor/src/util/I18n"),require("@polpware/fe-dependencies"),require("@polpware/fe-utilities")):"function"==typeof define&&define.amd?define("@polpware/fe-data",["exports","polpware-tinymce-tailor/src/util/XHR","polpware-tinymce-tailor/src/util/Tools","polpware-tinymce-tailor/src/util/EventDispatcher","@ngrx/store","@angular/core","polpware-tinymce-tailor/src/util/I18n","@polpware/fe-dependencies","@polpware/fe-utilities"],t):t((e.polpware=e.polpware||{},e.polpware["fe-data"]={}),e["polpware-tinymce-tailor/src/util/XHR"],e["polpware-tinymce-tailor/src/util/Tools"],e["polpware-tinymce-tailor/src/util/EventDispatcher"],e.ngrxStore,e.ng.core,e["polpware-tinymce-tailor/src/util/I18n"],e.dependencies,e.polpwareUtil)}(this,function(e,r,n,o,i,a,s,t,c){"use strict";var u=t.backbone,p=t.underscore,l=t.constraintjs,f=function(){function e(e,t){var r=this;if(this.dummyRecords=t,this._name=e.name,this._cascade=!1,this._foreignRelation={},this._reverseForeignRelation={},e.dataProviderCtor)this._dataProvider=new e.dataProviderCtor;else{var n=u.Collection.extend(e.dataProviderCtorOption||{});this._dataProvider=new n}this._addConstraint=l.constraint([]),this._deleteConstraint=l.constraint([]),this._onDeletedHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.onDeleted()},this._deleteConstraint.onChange(this._onDeletedHandler)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cascade",{get:function(){return this._cascade},enumerable:!0,configurable:!0}),e.prototype.dataProvider=function(){return this._dataProvider},e.prototype.onDeleted=function(){},e.prototype.hasAnyReference=function(o){if(!this._dataProvider.get(o.id))return!1;var t=this._reverseForeignRelation,r=!1,e=function(n){if(t.hasOwnProperty(n)){var e=t[n];if(r=p.some(e,function(e){var t=e.dataProvider(),r={};return r[n]=o.id,!!t.findWhere(r)}))return"break"}};for(var n in t){if("break"===e(n))break}return r},e.prototype.removeReverseForeign=function(t){var e=this._reverseForeignRelation,r=function(i){e.hasOwnProperty(i)&&e[i].forEach(function(e){var n=e.dataProvider(),o=[];t.forEach(function(e){var t={};t[i]=e.id;var r=n.where(t);c.pushArray(o,r)}),o.forEach(function(e){e.destroyFromTable()})})};for(var n in e)r(n)},e.prototype.get=function(e){return this._dataProvider.get(e)},e.prototype.destroyFromTable=function(e){var t=this._dataProvider.remove(e);t&&(t.set("invalidated",!0),t.trigger("destroy",t),this.removeReverseForeign([t]))},e.prototype.getForeignModel=function(e,t){var r=e.attributes[t];return r?this._foreignRelation[t].dataProvider().get(r):this.dummyRecords.getDummyRecord(t)},e.prototype.add=function(e){var t=this,r=this._dataProvider,n=(this._foreignRelation,r.modelId(e)),o=r.get(n);if(o){var i=p.extend({},o.attributes,e);return o.set(i),o}return(o=r.add(e)).destroyFromTable=function(){t.destroyFromTable(this)},o.getForeignModel=function(e){return t.getForeignModel(this,e)},o.hasAnyReference=function(){return t.hasAnyReference(this)},o},e.prototype.addMany=function(e){var t=this;return e.map(function(e){return t.add(e)})},e.prototype.addForeignRelation=function(e,t){if(this._foreignRelation[e])throw new Error("Foreign key exists: "+e);this._foreignRelation[e]=t},e.prototype.addReverseForeignRelation=function(e,t){var r=this._reverseForeignRelation[e];if(r){if(-1!==r.findIndex(function(e){return e===t}))throw new Error("Reverse foreign table exists: "+e);r.push(t)}else this._reverseForeignRelation[e]=[t]},e.prototype.hasForeignRelation=function(e){return!!this._foreignRelation[e]},e.prototype.hasReverseForeignRelation=function(e){return!!this._reverseForeignRelation[e]},e.prototype.destroy=function(){this._deleteConstraint.offChange(this._onDeletedHandler),this._dataProvider.reset()},e}(),h=t.backbone,d=function(){function e(){this._data={}}return e.prototype.getDummyRecord=function(e){return this._data[e]||(this._data[e]=new h.Model({})),this._data[e]},e}(),y=function(){function e(){this._referenceCounter=1,this._tableCollection={},this._dummyRecords=new d}return e.prototype.getReference=function(){return this._referenceCounter++,this},e.prototype.addTable=function(e){return this._tableCollection[e.name]=new f(e,this._dummyRecords)},e.prototype.getTable=function(e){return this._tableCollection[e]},e.prototype.addForeignkey=function(e,t,r){var n=this._tableCollection[e];if(!n)throw new Error("Undefined table: "+e);var o=this._tableCollection[r];if(!o)throw new Error("Undefined foreign table: "+r);n.addForeignRelation(t,o),o.addReverseForeignRelation(t,n)},e.prototype.destroy=function(){if(this._referenceCounter--,0===this._referenceCounter){for(var e in this._tableCollection){if(this._tableCollection.hasOwnProperty(e))this._tableCollection[e].destroy()}this._tableCollection={}}},e}(),v=t.underscore,g={async:!0,content_type:"",response_type:"json",requestheaders:[],success_scope:null,error_scope:null,scope:null};var _=t.jquery;function m(e){return _.ajax({url:e,cache:!0,dataType:"json"})}var b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function P(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var w=function(){return(w=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function x(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(a=(i<3?o(a):3<i?o(t,r,a):o(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}function O(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function E(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}var k=function(){function e(){this._store={}}return e.prototype.set=function(e,t){return this._store[e]=t},e.prototype.get=function(e){return this._store[e]||null},e.prototype.remove=function(e){delete this._store[e]},e.prototype.length=function(e){return Object.keys(this._store).length},e.prototype.key=function(e){var t=Object.keys(this._store);return 0<=e&&e<t.length?t[e]:""},e.prototype.enabled=function(){return!0},e}(),T=function(r){return r._eventDispatcher||(r._eventDispatcher=new o({scope:r,toggleEvent:function(e,t){o.isNative(e)&&r.toggleNativeEvent&&r.toggleNativeEvent(e,t)}})),r._eventDispatcher};function R(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return P(t,e),t.prototype.fire=function(e,t,r){if(this.removed&&"remove"!==e)return null;var n=T(this).fire(e,t,r);if(!1!==r&&this.parent)for(var o=this.parent();o&&!n.isPropagationStopped();)o.fire(e,n,!1),o=o.parent();return n},t.prototype.on=function(e,t,r){return T(this).on(e,t,r)},t.prototype.off=function(e,t){return T(this).off(e,t)},t.prototype.once=function(e,t){return T(this).once(e,t)},t.prototype.hasEventListeners=function(e){return T(this).has(e)},t}(e)}var I=t.locache,j=t.meld,C=Object.getPrototypeOf(I.locache).remove,F=function(){return(new Date).getTime()},S=function(){function e(e,t,r){var o=this;this._defaultSeconds=e;var n=new k;this._cache=I.locache.createCache({storage:n}),this._cache.remove=j.around(C,function(e){var t=e.args[0],r=o.onExpireEventName(t);if(o.asObservable.fire(r,{}).isDefaultPrevented())return o.resetExpireKey(t,o._defaultSeconds),!1;o.asObservable.off(r,null),e.proceed();var n=o.afterRemoveEventName(t);return o.asObservable.fire(n,{}),!0}),t?r?r.runOutsideAngular(function(){o._timeInterval=setInterval(function(){o._cache.cleanup()},1e3*t)}):this._timeInterval=setInterval(function(){o._cache.cleanup()},1e3*t):this._timeInterval=null}return e.prototype.onExpireEventName=function(e){return"onExpire:"+e},e.prototype.afterRemoveEventName=function(e){return"afterRemove:"+e},e.prototype.resetExpireKey=function(e,t){var r=this._cache.expirekey(e),n=1e3*t;this._cache.storage.set(r,F()+n)},Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t,r,n){var o=this._cache.expirekey(e),i=this._cache.key(e);if(r){var a=1e3*r;this._cache.storage.set(o,F()+a)}else this._cache.storage.remove(o);return n&&this.asObservable.once(this.afterRemoveEventName(e),n),this._cache.storage.set(i,t)},e.prototype.get=function(e,t){if(this._cache.hasExpired(e)&&this._cache.remove(e))return null;var r=this._cache.key(e),n=this._cache.storage.get(r);return n&&this.resetExpireKey(e,t||this._defaultSeconds),n},e.prototype.rmOnExpireHandler=function(e,t){this.asObservable.off(this.onExpireEventName(e),t)},e.prototype.addOnExpireHandler=function(e,t){this.asObservable.on(this.onExpireEventName(e),t)},Object.defineProperty(e.prototype,"count",{get:function(){return this._cache.length()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var t=this;this._cache.keys().forEach(function(e){t.asObservable.off(t.onExpireEventName(e),null),C.call(t._cache,e),t.asObservable.fire(t.afterRemoveEventName(e),{})})},e.prototype.destroy=function(){this.reset(),this._timeInterval&&clearInterval(this._timeInterval)},e=x([R,O("design:paramtypes",[Number,Number,Object])],e)}(),D={url:"dummy",clientId:"dummy",clientSecret:"dummy",scope:"all"},A=t.underscore,N=function(){function e(e){this.url=e.url,this.token=""}return e.prototype.getTokenP=function(){var t=this;return A.isEmpty(this.token)||this.isExpired()?this.getTokenInternal().then(function(e){return t.token=e}):c.lift(this.token,null)},e.prototype.reset=function(){this.token=""},e}(),q=t.jquery;function K(e){return(e=e||{}).expiresIn=e.expiresIn||0,e.createdOn=e.createdOn||0,e.token=e.token||"",e.refreshToken=e.refreshToken||"",e}var M=function(r){function e(e){var t=r.call(this,e)||this;return t.clientId=e.clientId,t.clientSecret=e.clientSecret,t.scope=e.scope,t.expiresIn=null,t.createdOn=null,t.refreshToken="",t}return P(e,r),e.prototype.readFrom=function(e){this.expiresIn=e.expiresIn,this.createdOn=e.createdOn,this.token=e.token,this.refreshToken=e.refreshToken},e.prototype.persistent=function(){return{expiresIn:this.expiresIn,createdOn:this.createdOn,token:this.token,refreshToken:this.refreshToken}},e.prototype.getParams=function(){return{client_id:this.clientId,client_secret:this.clientSecret,scope:this.scope,grant_type:this.grantType}},e.prototype.getTokenInternal=function(){var t=this,e=this.getParams();return q.ajax({url:this.url,data:e,method:"POST"}).then(function(e){return t.createdOn=(new Date).getTime(),t.expiresIn=e.expires_in,t.refreshToken=e.refreshToken||"",e.access_token})},e.prototype.isExpired=function(){if(!this.token||this.token.length<1)return!0;if(!this.createdOn)return!0;var e=c.safeParseInt(this.expiresIn);return e<=0||!((new Date).getTime()-this.createdOn<1e3*e)},e.prototype.applyTo=function(e){var t=this;e.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer ".concat(t.token))}},e.prototype.applyToV2=function(e){e.headers=e.headers||{},e.headers={Authorization:"Bearer ".concat(this.token)}},e.prototype.applyToV3=function(e){e.requestheaders=e.requestheaders||[],e.requestheaders.push({key:"Authorization",value:"Bearer ".concat(this.token)})},e.prototype.reset=function(){r.prototype.reset.call(this),this.refreshToken="",this.expiresIn=null,this.createdOn=null},e}(N);var U=function(t){function e(){var e=t.call(this,D)||this;return e._openId="",e}return P(e,t),e.prototype.persistent=function(){var e=t.prototype.persistent.call(this);return w({},e,{openId:this._openId})},e.prototype.readFrom=function(e){return t.prototype.readFrom.call(this,e),this._openId=e.openId,this},e}(M),V=function(){function e(){}return e.prototype.getTokenInternal=function(){throw new Error("NotImplemented")},e.prototype.applyTo=function(e){},e.prototype.isExpired=function(){return!1},e.prototype.readFrom=function(e){},e.prototype.persistent=function(){},e.prototype.applyToV2=function(e){},e.prototype.applyToV3=function(e){},e.prototype.getTokenP=function(){throw new Error("NotImplemented")},e.prototype.reset=function(){},e}(),B=t.underscore;var H=function(){function e(e){this.authPolicy=e,this._user={},this._security=e}return Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.security=function(e){return e&&(this._security=e),this._security},e.prototype.readFrom=function(e){this._user=B.extend(this._user,e)},e.prototype.setUser=function(e){(function a(e,t){if(e===t)return!0;if(null===e||null===t)return e===t;if("object"!=typeof e||"object"!=typeof t)return e===t;if(c.isArray(t)&&c.isArray(e)){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(!a(e[r],t[r]))return!1}var n={},o=t;for(var r in o)if(o.hasOwnProperty(r)){if(!a(e[r],t[r]))return!1;n[r]=!0}var i=e;for(var r in i)if(i.hasOwnProperty(r)&&!n[r]&&!a(e[r],t[r]))return!1;return!0})(this._user,e)||(this._user=e,this.asObservable.fire("change:user",{data:this._user}))},e.prototype.extendUser=function(e){var t=B.extend({},this._user,e);this.setUser(t)},e.prototype.getUser=function(){return B.extend({},this._user)},e.prototype.subscribe=function(e,t){(void 0===t&&(t=!1),this.asObservable.on("change:user",e),t)&&e({data:this._user})},e.prototype.unSubscribe=function(e){this.asObservable.off("change:user",e)},e.prototype.isUserKnown=function(){return!(!this._user||!this._user.username)},e.prototype.isAuthenticated=function(){return this.authPolicy&&!this.authPolicy.isExpired()},e=x([R,O("design:paramtypes",[Object])],e)}(),G=t.jquery;var J=function(r){function e(e){var t=r.call(this,e)||this;return t._antiForgeryKey=e.antiForgeryKey||"__RequestVerificationToken",t._elementTag=e.elementTag||"",t._expired=!0,t}return P(e,r),e.prototype.isExpired=function(){return this._expired},e.prototype.inputField=function(){return'input[name="'+this._antiForgeryKey+'"]'},e.prototype.readFrom=function(e){this.token=e.token},e.prototype.persistent=function(){return{token:this.token}},e.prototype.getTokenInternal=function(){var e=function t(e,o,i){return G.ajax({url:e,dataType:"html text"}).then(function(e){var t,r,n;return r="",t=(new DOMParser).parseFromString(e,"text/html"),o?0<(n=G(t).find(o)).length&&0<(n=G(t).find(i)).length&&(r=(n=n.eq(0)).attr("value")):0<(n=G(t).find(i)).length&&(r=(n=n.eq(0)).attr("value")),r})}(this.url,this._elementTag,this.inputField());c.liftWithGuard(e,function(e){var t=e&&0<e.length;return this._expired=!t,t});return e},e.prototype.applyTo=function(e){e.data[this._antiForgeryKey]=this.token},e.prototype.applyToV2=function(e){e.params=e.params||{},e.params[this._antiForgeryKey]=this.token},e.prototype.applyToV3=function(e){},e.prototype.reset=function(){r.prototype.reset.call(this),this._expired=!0},e}(N),L=function(n){function e(e,t){var r=n.call(this,e)||this;return r._payload=w({},t),r}return P(e,n),Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),e.prototype.getParams=function(){var e=n.prototype.getParams.call(this);return w({},e,this._payload)},e}(M);function z(e,r){switch(r.type){case"ADD":var t=r.payload.filter(function(t){return-1===e.items.findIndex(function(e){return t.id===e.id})});return w({},e,{items:function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(E(arguments[t]));return e}(e.items,t)});case"REMOVE":var n=e.items.filter(function(t){return-1===r.payload.findIndex(function(e){return t.id===e.id})});return w({},e,{items:n});case"MODIFY":default:return e}}function W(){return{collection:{items:[]}}}function X(){return{collection:z}}function Y(){var e=new i.ActionsSubject,t=new i.ScannedActionsSubject,r=i.combineReducers,n=new i.ReducerManager(e,{collection:{items:[]}},X(),r),o=new i.State(e,n,t,{collection:{items:[]}});return new i.Store(o,e,n)}var Q=function(){function e(){}return e.prototype.add=function(e){this.getStore().dispatch({type:"ADD",payload:e})},e.prototype.remove=function(e){this.getStore().dispatch({type:"REMOVE",payload:e})},e.prototype.modify=function(e){this.getStore().dispatch({type:"MODIFY",payload:e})},e}(),Z=function(t){function e(){var e=t.call(this)||this;return e._store=Y(),e}return P(e,t),e.prototype.getStore=function(){return this._store},e.prototype.getState=function(){return this._store.select("collection")},e.decorators=[{type:a.Injectable}],e.ctorParameters=function(){return[]},e}(Q),$=t.when,ee=t.underscore;var te=function(){function e(e){this._providerGenerator=e,this._workingProviders=[]}return e.prototype.hasNextPage=function(){return 0===this._workingProviders.length||(!!this._providerGenerator.hasMore()||ee.some(this._workingProviders,function(e){return e.hasNextPage()}))},e.prototype.getFirstPage=function(){var r=this;return this._providerGenerator.getNext().then(function(e){return e=ee.filter(e,function(e){return function t(e){return!e.state.totalPages&&!e.state.totalRecords||e.hasNextPage()}(e)})}).then(function(e){r._workingProviders.length=0;var t=ee.map(e,function(t){var r=this;return function n(e){return e.state.totalPages||e.state.totalRecords?e.getNextPage():e.getFirstPage()}(t).then(function(e){return r._workingProviders.push(t),e})});return $.settle(t)})},e.prototype.getNextPage=function(){return this.getFirstPage()},e.prototype.reset=function(){this._providerGenerator.reset(),this._workingProviders=[]},e.prototype.forEach=function(t){this._workingProviders.forEach(function(e){e.forEach(t)})},e.prototype.get=function(e){},e}(),re=t.backbone,ne=t.meld;function oe(e){return ne.before(re,"sync",e)}function ie(e){return ne.around(re,"sync",e)}function ae(e){return ne.before(re,"ajax",e)}var se=t.dataflow,ce=t.backbone,ue=t.underscore,pe={model:1,collection:2,pagedCollection:3},le={read:"read",create:"create",patch:"patch",update:"update","delete":"delete"},fe={},he=[];var de=function(){function e(e){this._cache=new S(300),this._dataflow=new se,this._myEndPointKeys=[],this._host=e.webhost||"",this._uniqueNamePrefix=this._host?this._host.replace(".","-")+"-":"",function t(){if(!(0<he.length)){var e=oe(function(e,t,r){if(r.methodKey=e,r.endPointKey=t.endPointKey||(t.collection?t.collection.endPointKey:null),r.endPointKey){var n=fe[r.endPointKey].options;"delete"===e?(n.deleteUrl&&(r.url=n.deleteUrl),n.deleteContentType&&(r.contentType=n.deleteContentType)):"update"===e?(n.updateUrl&&(r.url=n.updateUrl),n.updateContentType&&(r.contentType=n.updateContentType)):"create"===e?(n.createUrl&&(r.url=n.createUrl),n.createContentType&&(r.contentType=n.createContentType)):"patch"===e&&(n.patchUrl&&(r.url=n.patchUrl),n.patchContentType&&(r.contentType=n.patchContentType))}});he.push(e),e=ae(function(e){if(e.endPointKey){var t=fe[e.endPointKey].options,r=t.securityDelegate,n=t.extraParams;"application/x-www-form-urlencoded"===t.contentType&&"application/json"===e.contentType?(e.data=JSON.parse(e.data),n&&ue.extend(e.data,n),r&&r(e),e.data=c.urlEncode(e.data),e.contentType=t.contentType):(n&&ue.extend(e.data,n),r&&r(e),"application/x-www-form-urlencoded"===e.contentType&&(e.data=c.urlEncode(e.data)))}}),he.push(e),e=ie(function(e){var t=e.args[2];if(t.endPointKey){var r=fe[t.endPointKey],n=r.options;if(n.syncDelegate)return(0,n.syncDelegate)(t.endPointKey,t,r,function(){return e.proceed()})}return e.proceed()}),he.push(e)}}()}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configurationMapping",{get:function(){return fe},enumerable:!0,configurable:!0}),e.prototype.addEndPoint=function(e,t,r){var n=this.configurationMapping,o=this._dataflow,i=this._uniqueNamePrefix+e;if(n[i])throw new Error("Redefined endpoint: "+e);if(n[i]={options:ue.extend(r,{endPointKey:i}),tag:t},this._myEndPointKeys.push(i),t===pe.model)for(var a in le){if(le.hasOwnProperty(a))o[e+":"+le[a]]=1}else o[e+":"+le.read]=1},e.prototype.getEndPoint=function(e,t){var r=this._cache,n=this._uniqueNamePrefix+e;if(!0!==t){var o=r.get(n);if(o)return o}var i=this.configurationMapping[n];if(!i)throw new Error("No given endpoint is defined for: "+e);var a=null;if(i.tag===pe.model)a=ce.Model.extend(i.options);else if(i.tag===pe.collection)a=ce.Collection.extend(i.options);else{if(i.tag!==pe.pagedCollection)throw new Error("Not implemented");a=ce.PageableCollection.extend(i.options)}return!0!==t&&r.set(n,a,300),a},e.prototype.getConfiguration=function(e){var t=this._uniqueNamePrefix+e;return this.configurationMapping[t]},e.prototype.addWhenCallback=function(e,t){this._dataflow.when(e,t)},e.prototype.addDependency=function(e,t){var r=this._dataflow;r.on(e,function(){r[t]=r[t]+1})},e.prototype.cleanupCache=function(){this._cache.reset()},e.prototype.cleanMountedFeatures=function(){he.forEach(function(e){e.remove()}),he.length=0},e.prototype.destroy=function(){this._myEndPointKeys.forEach(function(e){delete fe[e]}),this._myEndPointKeys.length=0,this._cache.destroy(),this._cache=null,this._dataflow=null,this._host=null,this._uniqueNamePrefix=null},e}(),ye=window.localStorage,ve=t.underscore,ge=ve.find,_e=ve.findIndex,me=ve.union;function be(e,t){var r=c.defaultValue(t);try{var n=ye.getItem(e);n&&"undefined"!==n&&(n=JSON.parse(n),c.ok(n,t)&&(r=n))}catch(o){console.log(o)}return r}function Pe(e,t,r){void 0===r&&(r=null);try{ye.setItem(e,JSON.stringify(t))}catch(n){console.log(n)}}function we(e,t){try{ye.setItem(e,JSON.stringify(c.defaultValue(t)))}catch(r){console.log(r)}}var xe=function(){function e(){}return e.prototype.getP=function(e){var t=be(e,c.tyObject);return c.lift(t,null)},e.prototype.removeP=function(e){return we(e,c.tyObject),c.lift(!0,null)},e.prototype.updateP=function(e,t){return Pe(e,t,c.tyObject),c.lift(!0,null)},e}(),Oe=function(){function e(){}return e.getDictByCode=function(e){return s.data[e]},e.add=function(e,t){s.add(e,t)},e.translate=function(e,t){var r=s.translate(e);return r===e&&t?t:r},e.recycleOthers=function(e){var t=s.data,r=[];for(var n in t)t.hasOwnProperty(n)&&n!==e&&r.push(n);for(var o=0;o<r.length;o++){delete t[r[o]]}},e}();t.underscore.isString;function Ee(e,t,r){void 0===r&&(r=1);var n=t.slice(r).join(".");if(e[n])return e[n];for(var o=e,i=r;i<t.length&&o;i++){o=o[t[i]]}return o}var ke=function(){function e(e){void 0===e&&(e=null),this._cache=e,this._configuration={}}return e.prototype.register=function(e,t,r){void 0===r&&(r=60);var n=this._configuration;if(n[e])throw new Error("Registering an existing resource key: "+e);n[e]={uri:t,liveSeconds:r}},e.prototype.undoRegister=function(e){var t=this._configuration;t[e]&&delete t[e]},e.prototype.getPromise=function(e,t){var r=e.split("."),n=r[0],o=this._cache;if(o){var i=o.get(n,60);if(i){var a=Ee(i,r);if(a)return c.lift(a,null)}}var s=this._configuration[n];if(!s)throw new Error("Get unregistered resource: "+n);return m(s.uri).then(function(e){return e=t(e),o&&o.set(n,e,s.liveSeconds),Ee(e,r)})},e}();e.RelationalTable=f,e.DummyRecords=d,e.RelationDatabase=y,e.sendPromise=function Te(e){var t=v.extend({},g,e);return new Promise(function(n,o){var e={url:t.url,content_type:t.content_type,response_type:t.response_type,type:t.type,data:t.data,async:t.async,success:function(e,t,r){n({response:e,xhr:t,settings:r})},error:function(e,t,r){o({error:e,xhr:t,settings:r})},success_scope:t.success_scope,error_scope:t.error_scope,scope:t.scope,requestheaders:t.requestheaders};"application/x-www-form-urlencoded"===t.content_type?e.data=c.urlEncode(e.data):"application/json"===t.content_type&&(e.data=JSON.stringify(e.data)),r.send(e)})},e.loadJsonUriP=m,e.pingP=function Re(e,t){t=t||{};var r=n.extend({url:e},t);return _.ajax(r)},e.loadHtmlP=function Ie(e){return _.ajax({url:e,dataType:"html text"}).then(function(e){var t=(new DOMParser).parseFromString(e,"text/html");return _(t)})},e.SlidingExpirationCache=S,e.MemoryBackend=k,e.adaptToOpenIDToken=function je(e){var t=K(e=e||{});return w({},t,{openId:e.openId||""})},e.OpenIDPolicy=U,e.PolicyBase=N,e.NullPolicy=V,e.UserCredential=H,e.AntiForgeryKeyPolicy=J,e.adaptToOAuthToken=K,e.OAuthTokenExtPolicy=L,e.OAuthTokenPolicy=M,e.DummyOAuthTokenCtorParams=D,e.observableDecorator=R,e.factory=Y,e.CollectionStore=Z,e.CollectionAbstractStore=Q,e.reducer=z,e.buildInitialState=W,e.buildReducerMap=X,e.AggregateCollection=te,e.mountSyncListener=function Ce(e){return[ne.before(re.Collection.prototype,"trigger",e),ne.before(re.Model.prototype,"trigger",e)]},e.mountSyncBeforeAdvice=oe,e.mountSyncAroundAdvice=ie,e.mountAjaxBeforeAdvice=ae,e.endPointEnum=pe,e.syncMethodEnum=le,e.GlobalProvider=de,e.getEntity=be,e.updateEntity=Pe,e.cleanEntity=we,e.insertEntities=function Fe(e,t,r){var n=be(e,c.tyArray);Pe(e,0<r&&n.length>r?t:me(n,t),c.tyArray)},e.findEntityById=function Se(e,t){var r=be(e,c.tyArray);return ge(r,{Id:t})},e.removeEntityById=function De(e,t){var r=be(e,c.tyArray),n=_e(r,{Id:t});-1!==n&&(r.splice(n,1),Pe(e,r,c.tyArray))},e.insertOrUpdateEntity=function Ae(e,t){var r=be(e,c.tyArray),n=_e(r,{Id:t.Id});-1!==n?r[n]=t:r.push(t),Pe(e,r,c.tyArray)},e.cleanEntityGroup=function Ne(e){var t=[];for(var r in ye)ye.hasOwnProperty(r)&&0===r.indexOf(e)&&t.push(r);return 0===t.length||t.forEach(function(e){ye.removeItem(e)}),t},e.LocalStorageTable=xe,e.I18n=Oe,e.ResourceLoader=ke,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polpware-fe-data.umd.min.js.map