!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@polpware/fe-dependencies"),require("@polpware/fe-utilities"),require("@ngrx/store"),require("@angular/core")):"function"==typeof define&&define.amd?define("@polpware/fe-data",["exports","@polpware/fe-dependencies","@polpware/fe-utilities","@ngrx/store","@angular/core"],t):t(((e=e||self).polpware=e.polpware||{},e.polpware["fe-data"]={}),e.feDependencies,e.feUtilities,e.store,e.ng.core)}(this,function(e,t,n,r,o){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var l=t.backbone,h=t.underscore,d=t.constraintjs,y=function(){function e(e,t){var n=this;if(this.dummyRecords=t,this._name=e.name,this._cascade=!1,this._foreignRelation={},this._reverseForeignRelation={},e.dataProviderCtor)this._dataProvider=new e.dataProviderCtor;else{var r=l.Collection.extend(e.dataProviderCtorOption||{});this._dataProvider=new r}this._addConstraint=d.constraint([]),this._deleteConstraint=d.constraint([]),this._onDeletedHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.onDeleted()},this._deleteConstraint.onChange(this._onDeletedHandler)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cascade",{get:function(){return this._cascade},enumerable:!0,configurable:!0}),e.prototype.dataProvider=function(){return this._dataProvider},e.prototype.onDeleted=function(){},e.prototype.hasAnyReference=function(e){if(!this._dataProvider.get(e.id))return!1;var t=this._reverseForeignRelation,n=!1,r=function(r){if(t.hasOwnProperty(r)){var o=t[r];if(n=h.some(o,function(t){var n=t.dataProvider(),o={};return o[r]=e.id,!!n.findWhere(o)}))return"break"}};for(var o in t){if("break"===r(o))break}return n},e.prototype.removeReverseForeign=function(e){var t=this._reverseForeignRelation,r=function(r){t.hasOwnProperty(r)&&t[r].forEach(function(t){var o=t.dataProvider(),i=[];e.forEach(function(e){var t={};t[r]=e.id;var a=o.where(t);n.pushArray(i,a)}),i.forEach(function(e){e.destroyFromTable()})})};for(var o in t)r(o)},e.prototype.get=function(e){return this._dataProvider.get(e)},e.prototype.destroyFromTable=function(e){var t=this._dataProvider.remove(e);t&&(t.set("invalidated",!0),t.trigger("destroy",t),this.removeReverseForeign([t]))},e.prototype.getForeignModel=function(e,t){var n=e.attributes[t];return n?this._foreignRelation[t].dataProvider().get(n):this.dummyRecords.getDummyRecord(t)},e.prototype.add=function(e){var t=this,n=this._dataProvider,r=(this._foreignRelation,n.modelId(e)),o=n.get(r);if(o){var i=h.extend({},o.attributes,e);return o.set(i),o}return(o=n.add(e)).destroyFromTable=function(){t.destroyFromTable(this)},o.getForeignModel=function(e){return t.getForeignModel(this,e)},o.hasAnyReference=function(){return t.hasAnyReference(this)},o},e.prototype.addMany=function(e){var t=this;return e.map(function(e){return t.add(e)})},e.prototype.addForeignRelation=function(e,t){if(this._foreignRelation[e])throw new Error("Foreign key exists: "+e);this._foreignRelation[e]=t},e.prototype.addReverseForeignRelation=function(e,t){var n=this._reverseForeignRelation[e];if(n){if(-1!==n.findIndex(function(e){return e===t}))throw new Error("Reverse foreign table exists: "+e);n.push(t)}else this._reverseForeignRelation[e]=[t]},e.prototype.hasForeignRelation=function(e){return!!this._foreignRelation[e]},e.prototype.hasReverseForeignRelation=function(e){return!!this._reverseForeignRelation[e]},e.prototype.destroy=function(){this._deleteConstraint.offChange(this._onDeletedHandler),this._dataProvider.reset()},e}(),v=t.backbone,g=function(){function e(){this._data={}}return e.prototype.getDummyRecord=function(e){return this._data[e]||(this._data[e]=new v.Model({})),this._data[e]},e}(),_=function(){function e(){this._referenceCounter=1,this._tableCollection={},this._dummyRecords=new g}return e.prototype.getReference=function(){return this._referenceCounter++,this},e.prototype.addTable=function(e){return this._tableCollection[e.name]=new y(e,this._dummyRecords)},e.prototype.getTable=function(e){return this._tableCollection[e]},e.prototype.addForeignkey=function(e,t,n){var r=this._tableCollection[e];if(!r)throw new Error("Undefined table: "+e);var o=this._tableCollection[n];if(!o)throw new Error("Undefined foreign table: "+n);r.addForeignRelation(t,o),o.addReverseForeignRelation(t,r)},e.prototype.destroy=function(){if(this._referenceCounter--,0===this._referenceCounter){for(var e in this._tableCollection){if(this._tableCollection.hasOwnProperty(e))this._tableCollection[e].destroy()}this._tableCollection={}}},e}(),m=t.XHR,b=t.underscore,P={async:!0,content_type:"",response_type:"json",requestheaders:[],success_scope:null,error_scope:null,scope:null};
/**
     * @fileOverview
     * Provides a bunch of utilties on network communication.
     * @name Curl.js
     * @module hypercom/util/Curl
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
var w=t.Tools,x=t.jquery;function O(e){return x.ajax({url:e,cache:!0,dataType:"json"})}var E=function(){function e(){this._store={}}return e.prototype.set=function(e,t){return this._store[e]=t,t},e.prototype.get=function(e){return this._store[e]||null},e.prototype.remove=function(e){delete this._store[e]},e.prototype.length=function(e){return Object.keys(this._store).length},e.prototype.key=function(e){var t=Object.keys(this._store);return e>=0&&e<t.length?t[e]:""},e.prototype.enabled=function(){return!0},e}(),k=t.EventDispatcher,T=function(e){return e._eventDispatcher||(e._eventDispatcher=new k({scope:e,toggleEvent:function(t,n){k.isNative(t)&&e.toggleNativeEvent&&e.toggleNativeEvent(t,n)}})),e._eventDispatcher};function R(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.fire=function(e,t,n){if(this.removed&&"remove"!==e)return null;var r=T(this).fire(e,t,n);if(!1!==n&&this.parent)for(var o=this.parent();o&&!r.isPropagationStopped();)o.fire(e,r,!1),o=o.parent();return r},t.prototype.on=function(e,t,n){return T(this).on(e,t,n)},t.prototype.off=function(e,t){return T(this).off(e,t)},t.prototype.once=function(e,t){return T(this).once(e,t)},t.prototype.hasEventListeners=function(e){return T(this).has(e)},t}(e)}var I=t.locache,j=t.meld,C=Object.getPrototypeOf(I.locache).remove,F=function(){return(new Date).getTime()},S=F,D=function(){function e(e,t,n){var r=this;this._defaultSeconds=e;var o=new E;this._cache=I.locache.createCache({storage:o}),this._cache.remove=j.around(C,function(e){var t=e.args[0],n=r.onExpireEventName(t);if(r.asObservable.fire(n,{}).isDefaultPrevented())return r.resetExpireKey(t,r._defaultSeconds),!1;r.asObservable.off(n,null),e.proceed();var o=r.afterRemoveEventName(t);return r.asObservable.fire(o,{}),!0}),t?n?n.runOutsideAngular(function(){r._timeInterval=setInterval(function(){r._cache.cleanup()},1e3*t)}):this._timeInterval=setInterval(function(){r._cache.cleanup()},1e3*t):this._timeInterval=null}return e.prototype.onExpireEventName=function(e){return"onExpire:"+e},e.prototype.afterRemoveEventName=function(e){return"afterRemove:"+e},e.prototype.resetExpireKey=function(e,t){var n=this._cache.expirekey(e),r=1e3*t;this._cache.storage.set(n,F()+r)},Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t,n,r){var o=this._cache.expirekey(e),i=this._cache.key(e);if(n){var a=1e3*n;this._cache.storage.set(o,F()+a)}else this._cache.storage.remove(o);return r&&this.asObservable.once(this.afterRemoveEventName(e),r),this._cache.storage.set(i,t)},e.prototype.get=function(e,t){if(this._cache.hasExpired(e)&&this._cache.remove(e))return null;var n=this._cache.key(e),r=this._cache.storage.get(n);return r&&this.resetExpireKey(e,t||this._defaultSeconds),r},e.prototype.rmOnExpireHandler=function(e,t){this.asObservable.off(this.onExpireEventName(e),t)},e.prototype.addOnExpireHandler=function(e,t){this.asObservable.on(this.onExpireEventName(e),t)},Object.defineProperty(e.prototype,"count",{get:function(){return this._cache.length()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var e=this;this._cache.keys().forEach(function(t){e.asObservable.off(e.onExpireEventName(t),null),C.call(e._cache,t),e.asObservable.fire(e.afterRemoveEventName(t),{})})},e.prototype.destroy=function(){this.reset(),this._timeInterval&&clearInterval(this._timeInterval)},e=c([R,u("design:paramtypes",[Number,Number,Object])],e)}(),A={url:"dummy",clientId:"dummy",clientSecret:"dummy",scope:"all"},N=t.underscore,K=function(){function e(e){this.url=e.url,this.token=""}return e.prototype.getTokenP=function(){var e=this;return N.isEmpty(this.token)||this.isExpired()?this.getTokenInternal().then(function(t){return e.token=t}):n.lift(this.token,null)},e.prototype.reset=function(){this.token=""},e}(),M=t.jquery;function q(e){return(e=e||{}).expiresIn=e.expiresIn||0,e.createdOn=e.createdOn||0,e.token=e.token||"",e.refreshToken=e.refreshToken||"",e}var U=function(e){function t(t){var n=e.call(this,t)||this;return n.clientId=t.clientId,n.clientSecret=t.clientSecret,n.scope=t.scope,n.expiresIn=null,n.createdOn=null,n.refreshToken="",n.response=null,n}return a(t,e),t.prototype.readFrom=function(e){this.expiresIn=e.expiresIn,this.createdOn=e.createdOn,this.token=e.token,this.refreshToken=e.refreshToken},t.prototype.persistent=function(){return{expiresIn:this.expiresIn,createdOn:this.createdOn,token:this.token,refreshToken:this.refreshToken}},t.prototype.getParams=function(){return{client_id:this.clientId,client_secret:this.clientSecret,scope:this.scope,grant_type:this.grantType}},t.prototype.getTokenInternal=function(){var e=this,t=this.getParams();return M.ajax({url:this.url,data:t,method:"POST"}).then(function(t){return e.response=t,e.createdOn=(new Date).getTime(),e.expiresIn=t.expires_in,e.refreshToken=t.refreshToken||"",t.scope&&(e.scope=t.scope),t.access_token})},t.prototype.isExpired=function(){if(!this.token||this.token.length<1)return!0;if(!this.createdOn)return!0;var e=n.safeParseInt(this.expiresIn);return e<=0||!((new Date).getTime()-this.createdOn<1e3*e)},t.prototype.applyTo=function(e){var t=this;e.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer ".concat(t.token))}},t.prototype.applyToV2=function(e){e.headers=e.headers||{},e.headers={Authorization:"Bearer ".concat(this.token)}},t.prototype.applyToV3=function(e){e.requestheaders=e.requestheaders||[],e.requestheaders.push({key:"Authorization",value:"Bearer ".concat(this.token)})},t.prototype.reset=function(){e.prototype.reset.call(this),this.refreshToken="",this.expiresIn=null,this.createdOn=null},t}(K);var V=function(e){function t(){var t=e.call(this,A)||this;return t._openId="",t}return a(t,e),t.prototype.persistent=function(){var t=e.prototype.persistent.call(this);return s({},t,{openId:this._openId})},t.prototype.readFrom=function(t){return e.prototype.readFrom.call(this,t),this._openId=t.openId,this},t}(U),B=function(){function e(){}return e.prototype.getTokenInternal=function(){throw new Error("NotImplemented")},e.prototype.applyTo=function(e){},e.prototype.isExpired=function(){return!1},e.prototype.readFrom=function(e){},e.prototype.persistent=function(){},e.prototype.applyToV2=function(e){},e.prototype.applyToV3=function(e){},e.prototype.getTokenP=function(){throw new Error("NotImplemented")},e.prototype.reset=function(){},e}(),G=t.underscore;var H=function(){function e(e){this.authPolicy=e,this._user={},this._security=e}return Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.security=function(e){return e&&(this._security=e),this._security},e.prototype.readFrom=function(e){this._user=G.extend(this._user,e)},e.prototype.setUser=function(e){(function t(e,r){if(e===r)return!0;if(null===e||null===r)return e===r;if("object"!=typeof e||"object"!=typeof r)return e===r;if(n.isArray(r)&&n.isArray(e)){if(e.length!==r.length)return!1;for(var o=e.length;o--;)if(!t(e[o],r[o]))return!1}var i={},a=r;for(var o in a)if(a.hasOwnProperty(o)){if(!t(e[o],r[o]))return!1;i[o]=!0}var s=e;for(var o in s)if(s.hasOwnProperty(o)&&!i[o]&&!t(e[o],r[o]))return!1;return!0})(this._user,e)||(this._user=e,this.asObservable.fire("change:user",{data:this._user}))},e.prototype.extendUser=function(e){var t=G.extend({},this._user,e);this.setUser(t)},e.prototype.getUser=function(){return G.extend({},this._user)},e.prototype.subscribe=function(e,t){(void 0===t&&(t=!1),this.asObservable.on("change:user",e),t)&&e({data:this._user})},e.prototype.unSubscribe=function(e){this.asObservable.off("change:user",e)},e.prototype.isUserKnown=function(){return!(!this._user||!this._user.username)},e.prototype.isAuthenticated=function(){return this.authPolicy&&!this.authPolicy.isExpired()},e=c([R,u("design:paramtypes",[Object])],e)}(),J=t.jquery,L="__RequestVerificationToken",z="";var W=function(e){function t(t){var n=e.call(this,t)||this;return n._antiForgeryKey=t.antiForgeryKey||L,n._elementTag=t.elementTag||z,n._expired=!0,n}return a(t,e),t.prototype.isExpired=function(){return this._expired},t.prototype.inputField=function(){return'input[name="'+this._antiForgeryKey+'"]'},t.prototype.readFrom=function(e){this.token=e.token},t.prototype.persistent=function(){return{token:this.token}},t.prototype.getTokenInternal=function(){var e,t,r,o=(e=this.url,t=this._elementTag,r=this.inputField(),J.ajax({url:e,dataType:"html text"}).then(function(e){var n,o,i;return o="",n=(new DOMParser).parseFromString(e,"text/html"),t?(i=J(n).find(t)).length>0&&(i=J(n).find(r)).length>0&&(o=(i=i.eq(0)).attr("value")):(i=J(n).find(r)).length>0&&(o=(i=i.eq(0)).attr("value")),o}));n.liftWithGuard(o,function(e){var t=e&&e.length>0;return this._expired=!t,t});return o},t.prototype.applyTo=function(e){e.data[this._antiForgeryKey]=this.token},t.prototype.applyToV2=function(e){e.params=e.params||{},e.params[this._antiForgeryKey]=this.token},t.prototype.applyToV3=function(e){},t.prototype.reset=function(){e.prototype.reset.call(this),this._expired=!0},t}(K),Y=function(e){function t(t,n){var r=e.call(this,t)||this;return r._payload=s({},n),r}return a(t,e),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),t.prototype.getParams=function(){var t=e.prototype.getParams.call(this);return s({},t,this._payload)},t}(U);function X(e,t){switch(t.type){case"ADD":var n=t.payload.filter(function(t){return-1===e.items.findIndex(function(e){return t.id===e.id})});return s({},e,{items:f(e.items,n)});case"REMOVE":var r=e.items.filter(function(e){return-1===t.payload.findIndex(function(t){return e.id===t.id})});return s({},e,{items:r});case"MODIFY":default:return e}}function Q(){return{collection:{items:[]}}}function Z(){return{collection:X}}function $(){var e=new r.ActionsSubject,t=new r.ScannedActionsSubject,n=r.combineReducers,o=new r.ReducerManager(e,{collection:{items:[]}},Z(),n),i=new r.State(e,o,t,{collection:{items:[]}});return new r.Store(i,e,o)}var ee=function(){function e(){}return e.prototype.add=function(e){this.getStore().dispatch({type:"ADD",payload:e})},e.prototype.remove=function(e){this.getStore().dispatch({type:"REMOVE",payload:e})},e.prototype.modify=function(e){this.getStore().dispatch({type:"MODIFY",payload:e})},e}(),te=function(e){function t(){var t=e.call(this)||this;return t._store=$(),t}return a(t,e),t.prototype.getStore=function(){return this._store},t.prototype.getState=function(){return this._store.select("collection")},t=c([o.Injectable(),u("design:paramtypes",[])],t)}(ee),ne=t.when,re=t.underscore;var oe=function(){function e(e){this._providerGenerator=e,this._workingProviders=[]}return e.prototype.hasNextPage=function(){return 0===this._workingProviders.length||(!!this._providerGenerator.hasMore()||re.some(this._workingProviders,function(e){return e.hasNextPage()}))},e.prototype.getFirstPage=function(){var e=this;return this._providerGenerator.getNext().then(function(e){return e=re.filter(e,function(e){return!(t=e).state.totalPages&&!t.state.totalRecords||t.hasNextPage();var t})}).then(function(t){e._workingProviders.length=0;var n=re.map(t,function(e){var t,n=this;return(t=e,t.state.totalPages||t.state.totalRecords?t.getNextPage():t.getFirstPage()).then(function(t){return n._workingProviders.push(e),t})});return ne.settle(n)})},e.prototype.getNextPage=function(){return this.getFirstPage()},e.prototype.reset=function(){this._providerGenerator.reset(),this._workingProviders=[]},e.prototype.forEach=function(e){this._workingProviders.forEach(function(t){t.forEach(e)})},e.prototype.get=function(e){},e}(),ie=t.backbone,ae=t.meld;function se(e){return ae.before(ie,"sync",e)}function ce(e){return ae.around(ie,"sync",e)}function ue(e){return ae.before(ie,"ajax",e)}var pe=t.dataflow,fe=t.backbone,le=t.underscore,he={model:1,collection:2,pagedCollection:3},de={read:"read",create:"create",patch:"patch",update:"update","delete":"delete"},ye={},ve=[];var ge=300,_e=function(){function e(e){this._cache=new D(ge),this._dataflow=new pe,this._myEndPointKeys=[],this._host=e.webhost||"",this._uniqueNamePrefix=this._host?this._host.replace(".","-")+"-":"",function(){if(!(ve.length>0)){var e=se(function(e,t,n){if(n.methodKey=e,n.endPointKey=t.endPointKey||(t.collection?t.collection.endPointKey:null),n.endPointKey){var r=ye[n.endPointKey].options;"delete"===e?(r.deleteUrl&&(n.url=r.deleteUrl),r.deleteContentType&&(n.contentType=r.deleteContentType)):"update"===e?(r.updateUrl&&(n.url=r.updateUrl),r.updateContentType&&(n.contentType=r.updateContentType)):"create"===e?(r.createUrl&&(n.url=r.createUrl),r.createContentType&&(n.contentType=r.createContentType)):"patch"===e&&(r.patchUrl&&(n.url=r.patchUrl),r.patchContentType&&(n.contentType=r.patchContentType))}});ve.push(e),e=ue(function(e){if(e.endPointKey){var t=ye[e.endPointKey].options,r=t.securityDelegate,o=t.extraParams;"application/x-www-form-urlencoded"===t.contentType&&"application/json"===e.contentType?(e.data=JSON.parse(e.data),o&&le.extend(e.data,o),r&&r(e),e.data=n.urlEncode(e.data),e.contentType=t.contentType):(o&&le.extend(e.data,o),r&&r(e),"application/x-www-form-urlencoded"===e.contentType&&(e.data=n.urlEncode(e.data)))}}),ve.push(e),e=ce(function(e){var t=e.args[2];if(t.endPointKey){var n=ye[t.endPointKey],r=n.options;if(r.syncDelegate)return(0,r.syncDelegate)(t.endPointKey,t,n,function(){return e.proceed()})}return e.proceed()}),ve.push(e)}}()}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configurationMapping",{get:function(){return ye},enumerable:!0,configurable:!0}),e.prototype.addEndPoint=function(e,t,n){var r=this.configurationMapping,o=this._dataflow,i=this._uniqueNamePrefix+e;if(r[i])throw new Error("Redefined endpoint: "+e);if(r[i]={options:le.extend(n,{endPointKey:i}),tag:t},this._myEndPointKeys.push(i),t===he.model)for(var a in de){if(de.hasOwnProperty(a))o[e+":"+de[a]]=1}else o[e+":"+de.read]=1},e.prototype.getEndPoint=function(e,t){var n=this._cache,r=this._uniqueNamePrefix+e;if(!0!==t){var o=n.get(r);if(o)return o}var i=this.configurationMapping[r];if(!i)throw new Error("No given endpoint is defined for: "+e);var a=null;if(i.tag===he.model)a=fe.Model.extend(i.options);else if(i.tag===he.collection)a=fe.Collection.extend(i.options);else{if(i.tag!==he.pagedCollection)throw new Error("Not implemented");a=fe.PageableCollection.extend(i.options)}return!0!==t&&n.set(r,a,ge),a},e.prototype.getConfiguration=function(e){var t=this._uniqueNamePrefix+e;return this.configurationMapping[t]},e.prototype.addWhenCallback=function(e,t){this._dataflow.when(e,t)},e.prototype.addDependency=function(e,t){var n=this._dataflow;n.on(e,function(){n[t]=n[t]+1})},e.prototype.cleanupCache=function(){this._cache.reset()},e.prototype.cleanMountedFeatures=function(){ve.forEach(function(e){e.remove()}),ve.length=0},e.prototype.destroy=function(){this._myEndPointKeys.forEach(function(e){delete ye[e]}),this._myEndPointKeys.length=0,this._cache.destroy(),this._cache=null,this._dataflow=null,this._host=null,this._uniqueNamePrefix=null},e}(),me=window.localStorage,be=t.underscore,Pe=be.find,we=be.findIndex,xe=be.union;function Oe(e,t){var r=n.defaultValue(t);try{var o=me.getItem(e);o&&"undefined"!==o&&(o=JSON.parse(o),n.ok(o,t)&&(r=o))}catch(i){console.log(i)}return r}function Ee(e,t,n){void 0===n&&(n=null);try{me.setItem(e,JSON.stringify(t))}catch(r){console.log(r)}}function ke(e,t){try{me.setItem(e,JSON.stringify(n.defaultValue(t)))}catch(r){console.log(r)}}
/**
     * @fileOverview
     * Encapsulates the local storage service into one
     * providing prmoise-aware services.
     * @name LocalStorageTable.js
     * @module hypercom/storage/LocalStorageTable
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
var Te=function(){function e(){}return e.prototype.getP=function(e){var t=Oe(e,n.tyObject);return n.lift(t,null)},e.prototype.removeP=function(e){return ke(e,n.tyObject),n.lift(!0,null)},e.prototype.updateP=function(e,t){return Ee(e,t,n.tyObject),n.lift(!0,null)},e}(),Re=t.I18n,Ie=function(){function e(){}return e.getDictByCode=function(e){return Re.data[e]},e.add=function(e,t){Re.add(e,t)},e.translate=function(e,t){var n=Re.translate(e);return n===e&&t?t:n},e.recycleOthers=function(e){var t=Re.data,n=[];for(var r in t)t.hasOwnProperty(r)&&r!==e&&n.push(r);for(var o=0;o<n.length;o++){delete t[n[o]]}},e}();
/**
     * @fileOverview
     * Provides i18n service. This module is designed as
     * a delegate of the tinymce I18n service.
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */t.underscore.isString;function je(e,t,n){void 0===n&&(n=1);var r=t.slice(n).join(".");if(e[r])return e[r];for(var o=e,i=n;i<t.length&&o;i++){o=o[t[i]]}return o}var Ce=function(){function e(e){void 0===e&&(e=null),this._cache=e,this._configuration={}}return e.prototype.register=function(e,t,n){void 0===n&&(n=60);var r=this._configuration;if(r[e])throw new Error("Registering an existing resource key: "+e);r[e]={uri:t,liveSeconds:n}},e.prototype.undoRegister=function(e){var t=this._configuration;t[e]&&delete t[e]},e.prototype.getPromise=function(e,t){var r=e.split("."),o=r[0],i=this._cache;if(i){var a=i.get(o,60);if(a){var s=je(a,r);if(s)return n.lift(s,null)}}var c=this._configuration[o];if(!c)throw new Error("Get unregistered resource: "+o);return O(c.uri).then(function(e){return e=t(e),i&&i.set(o,e,c.liveSeconds),je(e,r)})},e}();e.AggregateCollection=oe,e.AntiForgeryKeyPolicy=W,e.CollectionAbstractStore=ee,e.CollectionStore=te,e.DummyOAuthTokenCtorParams=A,e.DummyRecords=g,e.GlobalProvider=_e,e.I18n=Ie,e.LocalStorageTable=Te,e.MemoryBackend=E,e.NullPolicy=B,e.OAuthTokenExtPolicy=Y,e.OAuthTokenPolicy=U,e.OpenIDPolicy=V,e.PolicyBase=K,e.RelationDatabase=_,e.RelationalTable=y,e.ResourceLoader=Ce,e.SlidingExpirationCache=D,e.UserCredential=H,e.adaptToOAuthToken=q,e.adaptToOpenIDToken=function(e){var t=q(e=e||{});return s({},t,{openId:e.openId||""})},e.buildInitialState=Q,e.buildReducerMap=Z,e.cleanEntity=ke,e.cleanEntityGroup=function(e){var t=[];for(var n in me)me.hasOwnProperty(n)&&0===n.indexOf(e)&&t.push(n);return 0===t.length?t:(t.forEach(function(e){me.removeItem(e)}),t)},e.endPointEnum=he,e.factory=$,e.findEntityById=function(e,t){var r=Oe(e,n.tyArray);return Pe(r,{Id:t})},e.getEntity=Oe,e.insertEntities=function(e,t,r){var o=Oe(e,n.tyArray);Ee(e,r>0&&o.length>r?t:xe(o,t),n.tyArray)},e.insertOrUpdateEntity=function(e,t){var r=Oe(e,n.tyArray),o=we(r,{Id:t.Id});-1!==o?r[o]=t:r.push(t),Ee(e,r,n.tyArray)},e.loadHtmlP=function(e){return x.ajax({url:e,dataType:"html text"}).then(function(e){var t=(new DOMParser).parseFromString(e,"text/html");return x(t)})},e.loadJsonUriP=O,e.mountAjaxBeforeAdvice=ue,e.mountSyncAroundAdvice=ce,e.mountSyncBeforeAdvice=se,e.mountSyncListener=function(e){return[ae.before(ie.Collection.prototype,"trigger",e),ae.before(ie.Model.prototype,"trigger",e)]},e.observableDecorator=R,e.pingP=function(e,t){t=t||{};var n=w.extend({url:e},t);return x.ajax(n)},e.reducer=X,e.removeEntityById=function(e,t){var r=Oe(e,n.tyArray),o=we(r,{Id:t});-1!==o&&(r.splice(o,1),Ee(e,r,n.tyArray))},e.sendPromise=function(e){var t=b.extend({},P,e);return new Promise(function(e,r){var o={url:t.url,content_type:t.content_type,response_type:t.response_type,type:t.type,data:t.data,async:t.async,success:function(t,n,r){e({response:t,xhr:n,settings:r})},error:function(e,t,n){r({error:e,xhr:t,settings:n})},success_scope:t.success_scope,error_scope:t.error_scope,scope:t.scope,requestheaders:t.requestheaders};"application/x-www-form-urlencoded"===t.content_type?o.data=n.urlEncode(o.data):"application/json"===t.content_type&&(o.data=JSON.stringify(o.data)),m.send(o)})},e.syncMethodEnum=de,e.updateEntity=Ee,e.ɵ0=S,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polpware-fe-data.umd.min.js.map