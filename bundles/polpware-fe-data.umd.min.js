!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@polpware/fe-dependencies"),require("@polpware/fe-utilities"),require("@ngrx/store"),require("@angular/core")):"function"==typeof define&&define.amd?define("@polpware/fe-data",["exports","@polpware/fe-dependencies","@polpware/fe-utilities","@ngrx/store","@angular/core"],t):t(((e=e||self).polpware=e.polpware||{},e.polpware["fe-data"]={}),e.feDependencies,e.feUtilities,e.store,e.ng.core)}(this,(function(e,t,r,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function c(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var l=t.backbone,h=t.underscore,d=t.constraintjs,y=function(){function e(e,t){var r=this;if(this.dummyRecords=t,this._name=e.name,this._cascade=!1,this._foreignRelation={},this._reverseForeignRelation={},e.dataProviderCtor)this._dataProvider=new e.dataProviderCtor;else{var n=l.Collection.extend(e.dataProviderCtorOption||{});this._dataProvider=new n}this._addConstraint=d.constraint([]),this._deleteConstraint=d.constraint([]),this._onDeletedHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.onDeleted()},this._deleteConstraint.onChange(this._onDeletedHandler)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cascade",{get:function(){return this._cascade},enumerable:!0,configurable:!0}),e.prototype.dataProvider=function(){return this._dataProvider},e.prototype.onDeleted=function(){},e.prototype.hasAnyReference=function(e){if(!this._dataProvider.get(e.id))return!1;var t=this._reverseForeignRelation,r=!1,n=function(n){if(t.hasOwnProperty(n)){var o=t[n];if(r=h.some(o,(function(t){var r=t.dataProvider(),o={};return o[n]=e.id,!!r.findWhere(o)})))return"break"}};for(var o in t){if("break"===n(o))break}return r},e.prototype.removeReverseForeign=function(e){var t=this._reverseForeignRelation,n=function(n){t.hasOwnProperty(n)&&t[n].forEach((function(t){var o=t.dataProvider(),i=[];e.forEach((function(e){var t={};t[n]=e.id;var a=o.where(t);r.pushArray(i,a)})),i.forEach((function(e){e.destroyFromTable()}))}))};for(var o in t)n(o)},e.prototype.get=function(e){return this._dataProvider.get(e)},e.prototype.destroyFromTable=function(e){var t=this._dataProvider.remove(e);t&&(t.set("invalidated",!0),t.trigger("destroy",t),this.removeReverseForeign([t]))},e.prototype.getForeignModel=function(e,t){var r=e.attributes[t];return r?this._foreignRelation[t].dataProvider().get(r):this.dummyRecords.getDummyRecord(t)},e.prototype.add=function(e){var t=this,r=this._dataProvider,n=(this._foreignRelation,r.modelId(e)),o=r.get(n);if(o){var i=h.extend({},o.attributes,e);return o.set(i),o}return(o=r.add(e)).destroyFromTable=function(){t.destroyFromTable(this)},o.getForeignModel=function(e){return t.getForeignModel(this,e)},o.hasAnyReference=function(){return t.hasAnyReference(this)},o},e.prototype.addMany=function(e){var t=this;return e.map((function(e){return t.add(e)}))},e.prototype.addForeignRelation=function(e,t){if(this._foreignRelation[e])throw new Error("Foreign key exists: "+e);this._foreignRelation[e]=t},e.prototype.addReverseForeignRelation=function(e,t){var r=this._reverseForeignRelation[e];if(r){if(-1!==r.findIndex((function(e){return e===t})))throw new Error("Reverse foreign table exists: "+e);r.push(t)}else this._reverseForeignRelation[e]=[t]},e.prototype.hasForeignRelation=function(e){return!!this._foreignRelation[e]},e.prototype.hasReverseForeignRelation=function(e){return!!this._reverseForeignRelation[e]},e.prototype.destroy=function(){this._deleteConstraint.offChange(this._onDeletedHandler),this._dataProvider.reset()},e}(),v=t.backbone,g=function(){function e(){this._data={}}return e.prototype.getDummyRecord=function(e){return this._data[e]||(this._data[e]=new v.Model({})),this._data[e]},e}(),_=function(){function e(){this._referenceCounter=1,this._tableCollection={},this._dummyRecords=new g}return e.prototype.getReference=function(){return this._referenceCounter++,this},e.prototype.addTable=function(e){return this._tableCollection[e.name]=new y(e,this._dummyRecords)},e.prototype.getTable=function(e){return this._tableCollection[e]},e.prototype.addForeignkey=function(e,t,r){var n=this._tableCollection[e];if(!n)throw new Error("Undefined table: "+e);var o=this._tableCollection[r];if(!o)throw new Error("Undefined foreign table: "+r);n.addForeignRelation(t,o),o.addReverseForeignRelation(t,n)},e.prototype.destroy=function(){if(this._referenceCounter--,0===this._referenceCounter){for(var e in this._tableCollection){if(this._tableCollection.hasOwnProperty(e))this._tableCollection[e].destroy()}this._tableCollection={}}},e}(),m=t.XHR,b=t.underscore,P={async:!0,content_type:"",response_type:"json",requestheaders:[],success_scope:null,error_scope:null,scope:null};
/**
     * @fileOverview
     * Provides a bunch of utilties on network communication.
     * @name Curl.js
     * @module hypercom/util/Curl
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
var w=t.Tools,x=t.jquery;function O(e){return x.ajax({url:e,cache:!0,dataType:"json"})}var E=function(){function e(){this._store={}}return e.prototype.set=function(e,t){return this._store[e]=t,t},e.prototype.get=function(e){return this._store[e]||null},e.prototype.remove=function(e){delete this._store[e]},e.prototype.length=function(e){return Object.keys(this._store).length},e.prototype.key=function(e){var t=Object.keys(this._store);return e>=0&&e<t.length?t[e]:""},e.prototype.enabled=function(){return!0},e}(),k=t.EventDispatcher,T=function(e){return e._eventDispatcher||(e._eventDispatcher=new k({scope:e,toggleEvent:function(t,r){k.isNative(t)&&e.toggleNativeEvent&&e.toggleNativeEvent(t,r)}})),e._eventDispatcher};function R(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.fire=function(e,t,r){if(this.removed&&"remove"!==e)return null;var n=T(this).fire(e,t,r);if(!1!==r&&this.parent)for(var o=this.parent();o&&!n.isPropagationStopped();)o.fire(e,n,!1),o=o.parent();return n},t.prototype.on=function(e,t,r){return T(this).on(e,t,r)},t.prototype.off=function(e,t){return T(this).off(e,t)},t.prototype.once=function(e,t){return T(this).once(e,t)},t.prototype.hasEventListeners=function(e){return T(this).has(e)},t}(e)}var I=t.locache,j=t.meld,C=Object.getPrototypeOf(I.locache).remove,F=function(){return(new Date).getTime()},S=function(){function e(e,t,r){var n=this;this._defaultSeconds=e;var o=new E;this._cache=I.locache.createCache({storage:o}),this._cache.remove=j.around(C,(function(e){var t=e.args[0],r=n.onExpireEventName(t);if(n.asObservable.fire(r,{}).isDefaultPrevented())return n.resetExpireKey(t,n._defaultSeconds),!1;n.asObservable.off(r,null),e.proceed();var o=n.afterRemoveEventName(t);return n.asObservable.fire(o,{}),!0})),t?r?r.runOutsideAngular((function(){n._timeInterval=setInterval((function(){n._cache.cleanup()}),1e3*t)})):this._timeInterval=setInterval((function(){n._cache.cleanup()}),1e3*t):this._timeInterval=null}return e.prototype.onExpireEventName=function(e){return"onExpire:"+e},e.prototype.afterRemoveEventName=function(e){return"afterRemove:"+e},e.prototype.resetExpireKey=function(e,t){var r=this._cache.expirekey(e),n=1e3*t;this._cache.storage.set(r,F()+n)},Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t,r,n){var o=this._cache.expirekey(e),i=this._cache.key(e);if(r){var a=1e3*r;this._cache.storage.set(o,F()+a)}else this._cache.storage.remove(o);return n&&this.asObservable.once(this.afterRemoveEventName(e),n),this._cache.storage.set(i,t)},e.prototype.get=function(e,t){if(this._cache.hasExpired(e)&&this._cache.remove(e))return null;var r=this._cache.key(e),n=this._cache.storage.get(r);return n&&this.resetExpireKey(e,t||this._defaultSeconds),n},e.prototype.rmOnExpireHandler=function(e,t){this.asObservable.off(this.onExpireEventName(e),t)},e.prototype.addOnExpireHandler=function(e,t){this.asObservable.on(this.onExpireEventName(e),t)},Object.defineProperty(e.prototype,"count",{get:function(){return this._cache.length()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var e=this;this._cache.keys().forEach((function(t){e.asObservable.off(e.onExpireEventName(t),null),C.call(e._cache,t),e.asObservable.fire(e.afterRemoveEventName(t),{})}))},e.prototype.destroy=function(){this.reset(),this._timeInterval&&clearInterval(this._timeInterval)},e.ctorParameters=function(){return[{type:Number},{type:Number},{type:void 0}]},e=c([R,u("design:paramtypes",[Number,Number,Object])],e)}(),N={url:"dummy",clientId:"dummy",clientSecret:"dummy",scope:"all"},D=t.underscore,A=function(){function e(e){this.url=e.url,this.token=""}return e.prototype.getTokenP=function(){var e=this;return D.isEmpty(this.token)||this.isExpired()?this.getTokenInternal().then((function(t){return e.token=t})):r.lift(this.token,null)},e.prototype.reset=function(){this.token=""},e}(),K=(t.underscore,t.jquery);function M(e){return(e=e||{}).expiresIn=e.expiresIn||0,e.createdOn=e.createdOn||0,e.token=e.token||"",e.refreshToken=e.refreshToken||"",e}var q=function(e){function t(t){var r=e.call(this,t)||this;return r.clientId=t.clientId,r.clientSecret=t.clientSecret,r.scope=t.scope,r.expiresIn=null,r.createdOn=null,r.refreshToken="",r.response=null,r}return a(t,e),t.prototype.readFrom=function(e){this.expiresIn=e.expiresIn,this.createdOn=e.createdOn,this.token=e.token,this.refreshToken=e.refreshToken},t.prototype.persistent=function(){return{expiresIn:this.expiresIn,createdOn:this.createdOn,token:this.token,refreshToken:this.refreshToken}},t.prototype.getParams=function(){return{client_id:this.clientId,client_secret:this.clientSecret,scope:this.scope,grant_type:this.grantType}},t.prototype.getTokenInternal=function(){var e=this,t=this.getParams();return K.ajax({url:this.url,data:t,method:"POST"}).then((function(t){return e.response=t,e.createdOn=(new Date).getTime(),e.expiresIn=t.expires_in,e.refreshToken=t.refreshToken||"",t.scope&&(e.scope=t.scope),t.access_token}))},t.prototype.isExpired=function(){if(!this.token||this.token.length<1)return!0;if(!this.createdOn)return!0;var e=r.safeParseInt(this.expiresIn);return e<=0||!((new Date).getTime()-this.createdOn<1e3*e)},t.prototype.applyTo=function(e){var t=this;e.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer ".concat(t.token))}},t.prototype.applyToV2=function(e){e.headers=e.headers||{},e.headers={Authorization:"Bearer ".concat(this.token)}},t.prototype.applyToV3=function(e){e.requestheaders=e.requestheaders||[],e.requestheaders.push({key:"Authorization",value:"Bearer ".concat(this.token)})},t.prototype.reset=function(){e.prototype.reset.call(this),this.refreshToken="",this.expiresIn=null,this.createdOn=null},t}(A);var U=function(e){function t(){var t=e.call(this,N)||this;return t._openId="",t}return a(t,e),t.prototype.persistent=function(){var t=e.prototype.persistent.call(this);return s(s({},t),{openId:this._openId})},t.prototype.readFrom=function(t){return e.prototype.readFrom.call(this,t),this._openId=t.openId,this},t}(q),V=function(){function e(){}return e.prototype.getTokenInternal=function(){throw new Error("NotImplemented")},e.prototype.applyTo=function(e){},e.prototype.isExpired=function(){return!1},e.prototype.readFrom=function(e){},e.prototype.persistent=function(){},e.prototype.applyToV2=function(e){},e.prototype.applyToV3=function(e){},e.prototype.getTokenP=function(){throw new Error("NotImplemented")},e.prototype.reset=function(){},e}(),B=t.underscore;var G=function(){function e(e){this.authPolicy=e,this._user={},this._security=e}return Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.security=function(e){return e&&(this._security=e),this._security},e.prototype.readFrom=function(e){this._user=B.extend(this._user,e)},e.prototype.setUser=function(e){(function e(t,n){if(t===n)return!0;if(null===t||null===n)return t===n;if("object"!=typeof t||"object"!=typeof n)return t===n;if(r.isArray(n)&&r.isArray(t)){if(t.length!==n.length)return!1;for(var o=t.length;o--;)if(!e(t[o],n[o]))return!1}var i={},a=n;for(var o in a)if(a.hasOwnProperty(o)){if(!e(t[o],n[o]))return!1;i[o]=!0}var s=t;for(var o in s)if(s.hasOwnProperty(o)&&!i[o]&&!e(t[o],n[o]))return!1;return!0})(this._user,e)||(this._user=e,this.asObservable.fire("change:user",{data:this._user}))},e.prototype.extendUser=function(e){var t=B.extend({},this._user,e);this.setUser(t)},e.prototype.getUser=function(){return B.extend({},this._user)},e.prototype.subscribe=function(e,t){(void 0===t&&(t=!1),this.asObservable.on("change:user",e),t)&&e({data:this._user})},e.prototype.unSubscribe=function(e){this.asObservable.off("change:user",e)},e.prototype.isUserKnown=function(){return!(!this._user||!this._user.username)},e.prototype.isAuthenticated=function(){return this.authPolicy&&!this.authPolicy.isExpired()},e.ctorParameters=function(){return[{type:void 0}]},e=c([R,u("design:paramtypes",[Object])],e)}(),H=t.jquery;var J=function(e){function t(t){var r=e.call(this,t)||this;return r._antiForgeryKey=t.antiForgeryKey||"__RequestVerificationToken",r._elementTag=t.elementTag||"",r._expired=!0,r}return a(t,e),t.prototype.isExpired=function(){return this._expired},t.prototype.inputField=function(){return'input[name="'+this._antiForgeryKey+'"]'},t.prototype.readFrom=function(e){this.token=e.token},t.prototype.persistent=function(){return{token:this.token}},t.prototype.getTokenInternal=function(){var e,t,n,o=(e=this.url,t=this._elementTag,n=this.inputField(),H.ajax({url:e,dataType:"html text"}).then((function(e){var r,o,i;return o="",r=(new DOMParser).parseFromString(e,"text/html"),t?(i=H(r).find(t)).length>0&&(i=H(r).find(n)).length>0&&(o=(i=i.eq(0)).attr("value")):(i=H(r).find(n)).length>0&&(o=(i=i.eq(0)).attr("value")),o})));r.liftWithGuard(o,(function(e){var t=e&&e.length>0;return this._expired=!t,t}));return o},t.prototype.applyTo=function(e){e.data[this._antiForgeryKey]=this.token},t.prototype.applyToV2=function(e){e.params=e.params||{},e.params[this._antiForgeryKey]=this.token},t.prototype.applyToV3=function(e){},t.prototype.reset=function(){e.prototype.reset.call(this),this._expired=!0},t}(A),L=function(e){function t(t,r){var n=e.call(this,t)||this;return n._payload=s({},r),n}return a(t,e),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),t.prototype.getParams=function(){var t=e.prototype.getParams.call(this);return s(s({},t),this._payload)},t}(q);function z(e,t){switch(t.type){case"ADD":var r=t.payload.filter((function(t){return-1===e.items.findIndex((function(e){return t.id===e.id}))}));return s(s({},e),{items:f(e.items,r)});case"REMOVE":var n=e.items.filter((function(e){return-1===t.payload.findIndex((function(t){return e.id===t.id}))}));return s(s({},e),{items:n});case"MODIFY":default:return e}}function W(){return{collection:{items:[]}}}function Y(){return{collection:z}}function X(){var e=new n.ActionsSubject,t=new n.ScannedActionsSubject,r=n.combineReducers,o=new n.ReducerManager(e,{collection:{items:[]}},Y(),r),i=new n.State(e,o,t,{collection:{items:[]}});return new n.Store(i,e,o)}var Q=function(){function e(){}return e.prototype.add=function(e){this.getStore().dispatch({type:"ADD",payload:e})},e.prototype.remove=function(e){this.getStore().dispatch({type:"REMOVE",payload:e})},e.prototype.modify=function(e){this.getStore().dispatch({type:"MODIFY",payload:e})},e}(),Z=function(e){function t(){var t=e.call(this)||this;return t._store=X(),t}return a(t,e),t.prototype.getStore=function(){return this._store},t.prototype.getState=function(){return this._store.select("collection")},t.ɵfac=function(e){return new(e||t)},t.ɵprov=o.ɵɵdefineInjectable({token:t,factory:t.ɵfac}),t}(Q),$=t.when,ee=t.underscore;var te=function(){function e(e){this._providerGenerator=e,this._workingProviders=[]}return e.prototype.hasNextPage=function(){return 0===this._workingProviders.length||(!!this._providerGenerator.hasMore()||ee.some(this._workingProviders,(function(e){return e.hasNextPage()})))},e.prototype.getFirstPage=function(){var e=this;return this._providerGenerator.getNext().then((function(e){return e=ee.filter(e,(function(e){return!(t=e).state.totalPages&&!t.state.totalRecords||t.hasNextPage();var t}))})).then((function(t){e._workingProviders.length=0;var r=ee.map(t,(function(e){var t,r=this;return(t=e,t.state.totalPages||t.state.totalRecords?t.getNextPage():t.getFirstPage()).then((function(t){return r._workingProviders.push(e),t}))}));return $.settle(r)}))},e.prototype.getNextPage=function(){return this.getFirstPage()},e.prototype.reset=function(){this._providerGenerator.reset(),this._workingProviders=[]},e.prototype.forEach=function(e){this._workingProviders.forEach((function(t){t.forEach(e)}))},e.prototype.get=function(e){},e}(),re=t.backbone,ne=t.meld;function oe(e){return ne.before(re,"sync",e)}function ie(e){return ne.around(re,"sync",e)}function ae(e){return ne.before(re,"ajax",e)}var se=t.dataflow,ce=t.backbone,ue=t.underscore,pe={model:1,collection:2,pagedCollection:3},fe={read:"read",create:"create",patch:"patch",update:"update",delete:"delete"},le={},he=[];var de=function(){function e(e){this._cache=new S(300),this._dataflow=new se,this._myEndPointKeys=[],this._host=e.webhost||"",this._uniqueNamePrefix=this._host?this._host.replace(".","-")+"-":"",function(){if(!(he.length>0)){var e=oe((function(e,t,r){if(r.methodKey=e,r.endPointKey=t.endPointKey||(t.collection?t.collection.endPointKey:null),r.endPointKey){var n=le[r.endPointKey].options;"delete"===e?(n.deleteUrl&&(r.url=n.deleteUrl),n.deleteContentType&&(r.contentType=n.deleteContentType)):"update"===e?(n.updateUrl&&(r.url=n.updateUrl),n.updateContentType&&(r.contentType=n.updateContentType)):"create"===e?(n.createUrl&&(r.url=n.createUrl),n.createContentType&&(r.contentType=n.createContentType)):"patch"===e&&(n.patchUrl&&(r.url=n.patchUrl),n.patchContentType&&(r.contentType=n.patchContentType))}}));he.push(e),e=ae((function(e){if(e.endPointKey){var t=le[e.endPointKey].options,n=t.securityDelegate,o=t.extraParams;"application/x-www-form-urlencoded"===t.contentType&&"application/json"===e.contentType?(e.data=JSON.parse(e.data),o&&ue.extend(e.data,o),n&&n(e),e.data=r.urlEncode(e.data),e.contentType=t.contentType):(o&&ue.extend(e.data,o),n&&n(e),"application/x-www-form-urlencoded"===e.contentType&&(e.data=r.urlEncode(e.data)))}})),he.push(e),e=ie((function(e){var t=e.args[2];if(t.endPointKey){var r=le[t.endPointKey],n=r.options;if(n.syncDelegate)return(0,n.syncDelegate)(t.endPointKey,t,r,(function(){return e.proceed()}))}return e.proceed()})),he.push(e)}}()}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configurationMapping",{get:function(){return le},enumerable:!0,configurable:!0}),e.prototype.addEndPoint=function(e,t,r){var n=this.configurationMapping,o=this._dataflow,i=this._uniqueNamePrefix+e;if(n[i])throw new Error("Redefined endpoint: "+e);if(n[i]={options:ue.extend(r,{endPointKey:i}),tag:t},this._myEndPointKeys.push(i),t===pe.model)for(var a in fe){if(fe.hasOwnProperty(a))o[e+":"+fe[a]]=1}else o[e+":"+fe.read]=1},e.prototype.getEndPoint=function(e,t){var r=this._cache,n=this._uniqueNamePrefix+e;if(!0!==t){var o=r.get(n);if(o)return o}var i=this.configurationMapping[n];if(!i)throw new Error("No given endpoint is defined for: "+e);var a=null;if(i.tag===pe.model)a=ce.Model.extend(i.options);else if(i.tag===pe.collection)a=ce.Collection.extend(i.options);else{if(i.tag!==pe.pagedCollection)throw new Error("Not implemented");a=ce.PageableCollection.extend(i.options)}return!0!==t&&r.set(n,a,300),a},e.prototype.getConfiguration=function(e){var t=this._uniqueNamePrefix+e;return this.configurationMapping[t]},e.prototype.addWhenCallback=function(e,t){this._dataflow.when(e,t)},e.prototype.addDependency=function(e,t){var r=this._dataflow;r.on(e,(function(){r[t]=r[t]+1}))},e.prototype.cleanupCache=function(){this._cache.reset()},e.prototype.cleanMountedFeatures=function(){he.forEach((function(e){e.remove()})),he.length=0},e.prototype.destroy=function(){this._myEndPointKeys.forEach((function(e){delete le[e]})),this._myEndPointKeys.length=0,this._cache.destroy(),this._cache=null,this._dataflow=null,this._host=null,this._uniqueNamePrefix=null},e}(),ye=window.localStorage,ve=t.underscore,ge=ve.find,_e=ve.findIndex,me=ve.union;function be(e,t){var n=r.defaultValue(t);try{var o=ye.getItem(e);o&&"undefined"!==o&&(o=JSON.parse(o),r.ok(o,t)&&(n=o))}catch(e){console.log(e)}return n}function Pe(e,t,r){void 0===r&&(r=null);try{ye.setItem(e,JSON.stringify(t))}catch(e){console.log(e)}}function we(e,t){try{ye.setItem(e,JSON.stringify(r.defaultValue(t)))}catch(e){console.log(e)}}
/**
     * @fileOverview
     * Encapsulates the local storage service into one
     * providing prmoise-aware services.
     * @name LocalStorageTable.js
     * @module hypercom/storage/LocalStorageTable
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
var xe=function(){function e(){}return e.prototype.getP=function(e){var t=be(e,r.tyObject);return r.lift(t,null)},e.prototype.removeP=function(e){return we(e,r.tyObject),r.lift(!0,null)},e.prototype.updateP=function(e,t){return Pe(e,t,r.tyObject),r.lift(!0,null)},e}(),Oe=t.I18n,Ee=function(){function e(){}return e.getDictByCode=function(e){return Oe.data[e]},e.add=function(e,t){Oe.add(e,t)},e.translate=function(e,t){var r=Oe.translate(e);return r===e&&t?t:r},e.recycleOthers=function(e){var t=Oe.data,r=[];for(var n in t)t.hasOwnProperty(n)&&n!==e&&r.push(n);for(var o=0;o<r.length;o++){delete t[r[o]]}},e}();
/**
     * @fileOverview
     * Provides i18n service. This module is designed as
     * a delegate of the tinymce I18n service.
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */t.underscore.isString;function ke(e,t,r){void 0===r&&(r=1);var n=t.slice(r).join(".");if(e[n])return e[n];for(var o=e,i=r;i<t.length&&o;i++){o=o[t[i]]}return o}var Te=function(){function e(e){void 0===e&&(e=null),this._cache=e,this._configuration={}}return e.prototype.register=function(e,t,r){void 0===r&&(r=60);var n=this._configuration;if(n[e])throw new Error("Registering an existing resource key: "+e);n[e]={uri:t,liveSeconds:r}},e.prototype.undoRegister=function(e){var t=this._configuration;t[e]&&delete t[e]},e.prototype.getPromise=function(e,t){var n=e.split("."),o=n[0],i=this._cache;if(i){var a=i.get(o,60);if(a){var s=ke(a,n);if(s)return r.lift(s,null)}}var c=this._configuration[o];if(!c)throw new Error("Get unregistered resource: "+o);return O(c.uri).then((function(e){return e=t(e),i&&i.set(o,e,c.liveSeconds),ke(e,n)}))},e}();e.AggregateCollection=te,e.AntiForgeryKeyPolicy=J,e.CollectionAbstractStore=Q,e.CollectionStore=Z,e.DummyOAuthTokenCtorParams=N,e.DummyRecords=g,e.GlobalProvider=de,e.I18n=Ee,e.LocalStorageTable=xe,e.MemoryBackend=E,e.NullPolicy=V,e.OAuthTokenExtPolicy=L,e.OAuthTokenPolicy=q,e.OpenIDPolicy=U,e.PolicyBase=A,e.RelationDatabase=_,e.RelationalTable=y,e.ResourceLoader=Te,e.SlidingExpirationCache=S,e.UserCredential=G,e.adaptToOAuthToken=M,e.adaptToOpenIDToken=function(e){var t=M(e=e||{});return s(s({},t),{openId:e.openId||""})},e.buildInitialState=W,e.buildReducerMap=Y,e.cleanEntity=we,e.cleanEntityGroup=function(e){var t=[];for(var r in ye)ye.hasOwnProperty(r)&&0===r.indexOf(e)&&t.push(r);return 0===t.length||t.forEach((function(e){ye.removeItem(e)})),t},e.endPointEnum=pe,e.factory=X,e.findEntityById=function(e,t){var n=be(e,r.tyArray);return ge(n,{Id:t})},e.getEntity=be,e.insertEntities=function(e,t,n){var o=be(e,r.tyArray);Pe(e,n>0&&o.length>n?t:me(o,t),r.tyArray)},e.insertOrUpdateEntity=function(e,t){var n=be(e,r.tyArray),o=_e(n,{Id:t.Id});-1!==o?n[o]=t:n.push(t),Pe(e,n,r.tyArray)},e.loadHtmlP=function(e){return x.ajax({url:e,dataType:"html text"}).then((function(e){var t=(new DOMParser).parseFromString(e,"text/html");return x(t)}))},e.loadJsonUriP=O,e.mountAjaxBeforeAdvice=ae,e.mountSyncAroundAdvice=ie,e.mountSyncBeforeAdvice=oe,e.mountSyncListener=function(e){return[ne.before(re.Collection.prototype,"trigger",e),ne.before(re.Model.prototype,"trigger",e)]},e.observableDecorator=R,e.pingP=function(e,t){t=t||{};var r=w.extend({url:e},t);return x.ajax(r)},e.reducer=z,e.removeEntityById=function(e,t){var n=be(e,r.tyArray),o=_e(n,{Id:t});-1!==o&&(n.splice(o,1),Pe(e,n,r.tyArray))},e.sendPromise=function(e){var t=b.extend({},P,e);return new Promise((function(e,n){var o={url:t.url,content_type:t.content_type,response_type:t.response_type,type:t.type,data:t.data,async:t.async,success:function(t,r,n){e({response:t,xhr:r,settings:n})},error:function(e,t,r){n({error:e,xhr:t,settings:r})},success_scope:t.success_scope,error_scope:t.error_scope,scope:t.scope,requestheaders:t.requestheaders};"application/x-www-form-urlencoded"===t.content_type?o.data=r.urlEncode(o.data):"application/json"===t.content_type&&(o.data=JSON.stringify(o.data)),m.send(o)}))},e.syncMethodEnum=fe,e.updateEntity=Pe,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=polpware-fe-data.umd.min.js.map