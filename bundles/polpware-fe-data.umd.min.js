!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store"),require("@angular/core"),require("@polpware/fe-dependencies"),require("@polpware/fe-utilities")):"function"==typeof define&&define.amd?define("@polpware/fe-data",["exports","@ngrx/store","@angular/core","@polpware/fe-dependencies","@polpware/fe-utilities"],t):t((e.polpware=e.polpware||{},e.polpware["fe-data"]={}),e.ngrxStore,e.ng.core,e.dependencies,e.polpwareUtil)}(this,function(e,i,n,t,c){"use strict";var o=t.backbone,a=t.underscore,s=t.constraintjs,r=function(){function e(e,t){var n=this;if(this.dummyRecords=t,this._name=e.name,this._cascade=!1,this._foreignRelation={},this._reverseForeignRelation={},e.dataProviderCtor)this._dataProvider=new e.dataProviderCtor;else{var r=o.Collection.extend(e.dataProviderCtorOption||{});this._dataProvider=new r}this._addConstraint=s.constraint([]),this._deleteConstraint=s.constraint([]),this._onDeletedHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.onDeleted()},this._deleteConstraint.onChange(this._onDeletedHandler)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cascade",{get:function(){return this._cascade},enumerable:!0,configurable:!0}),e.prototype.dataProvider=function(){return this._dataProvider},e.prototype.onDeleted=function(){},e.prototype.hasAnyReference=function(o){if(!this._dataProvider.get(o.id))return!1;var t=this._reverseForeignRelation,n=!1,e=function(r){if(t.hasOwnProperty(r)){var e=t[r];if(n=a.some(e,function(e){var t=e.dataProvider(),n={};return n[r]=o.id,!!t.findWhere(n)}))return"break"}};for(var r in t){if("break"===e(r))break}return n},e.prototype.removeReverseForeign=function(t){var e=this._reverseForeignRelation,n=function(i){e.hasOwnProperty(i)&&e[i].forEach(function(e){var r=e.dataProvider(),o=[];t.forEach(function(e){var t={};t[i]=e.id;var n=r.where(t);c.pushArray(o,n)}),o.forEach(function(e){e.destroyFromTable()})})};for(var r in e)n(r)},e.prototype.get=function(e){return this._dataProvider.get(e)},e.prototype.destroyFromTable=function(e){var t=this._dataProvider.remove(e);t&&(t.set("invalidated",!0),t.trigger("destroy",t),this.removeReverseForeign([t]))},e.prototype.getForeignModel=function(e,t){var n=e.attributes[t];return n?this._foreignRelation[t].dataProvider().get(n):this.dummyRecords.getDummyRecord(t)},e.prototype.add=function(e){var t=this,n=this._dataProvider,r=(this._foreignRelation,n.modelId(e)),o=n.get(r);if(o){var i=a.extend({},o.attributes,e);return o.set(i),o}return(o=n.add(e)).destroyFromTable=function(){t.destroyFromTable(this)},o.getForeignModel=function(e){return t.getForeignModel(this,e)},o.hasAnyReference=function(){return t.hasAnyReference(this)},o},e.prototype.addMany=function(e){var t=this;return e.map(function(e){return t.add(e)})},e.prototype.addForeignRelation=function(e,t){if(this._foreignRelation[e])throw new Error("Foreign key exists: "+e);this._foreignRelation[e]=t},e.prototype.addReverseForeignRelation=function(e,t){var n=this._reverseForeignRelation[e];if(n){if(-1!==n.findIndex(function(e){return e===t}))throw new Error("Reverse foreign table exists: "+e);n.push(t)}else this._reverseForeignRelation[e]=[t]},e.prototype.hasForeignRelation=function(e){return!!this._foreignRelation[e]},e.prototype.hasReverseForeignRelation=function(e){return!!this._reverseForeignRelation[e]},e.prototype.destroy=function(){this._deleteConstraint.offChange(this._onDeletedHandler),this._dataProvider.reset()},e}(),u=t.backbone,p=function(){function e(){this._data={}}return e.prototype.getDummyRecord=function(e){return this._data[e]||(this._data[e]=new u.Model({})),this._data[e]},e}(),f=function(){function e(){this._referenceCounter=1,this._tableCollection={},this._dummyRecords=new p}return e.prototype.getReference=function(){return this._referenceCounter++,this},e.prototype.addTable=function(e){return this._tableCollection[e.name]=new r(e,this._dummyRecords)},e.prototype.getTable=function(e){return this._tableCollection[e]},e.prototype.addForeignkey=function(e,t,n){var r=this._tableCollection[e];if(!r)throw new Error("Undefined table: "+e);var o=this._tableCollection[n];if(!o)throw new Error("Undefined foreign table: "+n);r.addForeignRelation(t,o),o.addReverseForeignRelation(t,r)},e.prototype.destroy=function(){if(this._referenceCounter--,0===this._referenceCounter){for(var e in this._tableCollection){if(this._tableCollection.hasOwnProperty(e))this._tableCollection[e].destroy()}this._tableCollection={}}},e}(),l=t.XHR,h=t.underscore,d={async:!0,content_type:"",response_type:"json",requestheaders:[],success_scope:null,error_scope:null,scope:null};var y=t.Tools,v=t.jquery;function g(e){return v.ajax({url:e,cache:!0,dataType:"json"})}var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function m(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function P(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(a=(i<3?o(a):3<i?o(t,n,a):o(t,n))||a);return 3<i&&a&&Object.defineProperty(t,n,a),a}function w(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function x(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var O=function(){function e(){this._store={}}return e.prototype.set=function(e,t){return this._store[e]=t},e.prototype.get=function(e){return this._store[e]||null},e.prototype.remove=function(e){delete this._store[e]},e.prototype.length=function(e){return Object.keys(this._store).length},e.prototype.key=function(e){var t=Object.keys(this._store);return 0<=e&&e<t.length?t[e]:""},e.prototype.enabled=function(){return!0},e}(),E=t.EventDispatcher,k=function(n){return n._eventDispatcher||(n._eventDispatcher=new E({scope:n,toggleEvent:function(e,t){E.isNative(e)&&n.toggleNativeEvent&&n.toggleNativeEvent(e,t)}})),n._eventDispatcher};function T(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return m(t,e),t.prototype.fire=function(e,t,n){if(this.removed&&"remove"!==e)return null;var r=k(this).fire(e,t,n);if(!1!==n&&this.parent)for(var o=this.parent();o&&!r.isPropagationStopped();)o.fire(e,r,!1),o=o.parent();return r},t.prototype.on=function(e,t,n){return k(this).on(e,t,n)},t.prototype.off=function(e,t){return k(this).off(e,t)},t.prototype.once=function(e,t){return k(this).once(e,t)},t.prototype.hasEventListeners=function(e){return k(this).has(e)},t}(e)}var R=t.locache,I=t.meld,j=Object.getPrototypeOf(R.locache).remove,C=function(){return(new Date).getTime()},F=function(){function e(e,t,n){var o=this;this._defaultSeconds=e;var r=new O;this._cache=R.locache.createCache({storage:r}),this._cache.remove=I.around(j,function(e){var t=e.args[0],n=o.onExpireEventName(t);if(o.asObservable.fire(n,{}).isDefaultPrevented())return o.resetExpireKey(t,o._defaultSeconds),!1;o.asObservable.off(n,null),e.proceed();var r=o.afterRemoveEventName(t);return o.asObservable.fire(r,{}),!0}),t?n?n.runOutsideAngular(function(){o._timeInterval=setInterval(function(){o._cache.cleanup()},1e3*t)}):this._timeInterval=setInterval(function(){o._cache.cleanup()},1e3*t):this._timeInterval=null}return e.prototype.onExpireEventName=function(e){return"onExpire:"+e},e.prototype.afterRemoveEventName=function(e){return"afterRemove:"+e},e.prototype.resetExpireKey=function(e,t){var n=this._cache.expirekey(e),r=1e3*t;this._cache.storage.set(n,C()+r)},Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t,n,r){var o=this._cache.expirekey(e),i=this._cache.key(e);if(n){var a=1e3*n;this._cache.storage.set(o,C()+a)}else this._cache.storage.remove(o);return r&&this.asObservable.once(this.afterRemoveEventName(e),r),this._cache.storage.set(i,t)},e.prototype.get=function(e,t){if(this._cache.hasExpired(e)&&this._cache.remove(e))return null;var n=this._cache.key(e),r=this._cache.storage.get(n);return r&&this.resetExpireKey(e,t||this._defaultSeconds),r},e.prototype.rmOnExpireHandler=function(e,t){this.asObservable.off(this.onExpireEventName(e),t)},e.prototype.addOnExpireHandler=function(e,t){this.asObservable.on(this.onExpireEventName(e),t)},Object.defineProperty(e.prototype,"count",{get:function(){return this._cache.length()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var t=this;this._cache.keys().forEach(function(e){t.asObservable.off(t.onExpireEventName(e),null),j.call(t._cache,e),t.asObservable.fire(t.afterRemoveEventName(e),{})})},e.prototype.destroy=function(){this.reset(),this._timeInterval&&clearInterval(this._timeInterval)},e=P([T,w("design:paramtypes",[Number,Number,Object])],e)}(),S={url:"dummy",clientId:"dummy",clientSecret:"dummy",scope:"all"},A=t.underscore,D=function(){function e(e){this.url=e.url,this.token=""}return e.prototype.getTokenP=function(){var t=this;return A.isEmpty(this.token)||this.isExpired()?this.getTokenInternal().then(function(e){return t.token=e}):c.lift(this.token,null)},e.prototype.reset=function(){this.token=""},e}(),N=t.jquery;function K(e){return(e=e||{}).expiresIn=e.expiresIn||0,e.createdOn=e.createdOn||0,e.token=e.token||"",e.refreshToken=e.refreshToken||"",e}var M=function(n){function e(e){var t=n.call(this,e)||this;return t.clientId=e.clientId,t.clientSecret=e.clientSecret,t.scope=e.scope,t.expiresIn=null,t.createdOn=null,t.refreshToken="",t}return m(e,n),e.prototype.readFrom=function(e){this.expiresIn=e.expiresIn,this.createdOn=e.createdOn,this.token=e.token,this.refreshToken=e.refreshToken},e.prototype.persistent=function(){return{expiresIn:this.expiresIn,createdOn:this.createdOn,token:this.token,refreshToken:this.refreshToken}},e.prototype.getParams=function(){return{client_id:this.clientId,client_secret:this.clientSecret,scope:this.scope,grant_type:this.grantType}},e.prototype.getTokenInternal=function(){var t=this,e=this.getParams();return N.ajax({url:this.url,data:e,method:"POST"}).then(function(e){return t.createdOn=(new Date).getTime(),t.expiresIn=e.expires_in,t.refreshToken=e.refreshToken||"",e.access_token})},e.prototype.isExpired=function(){if(!this.token||this.token.length<1)return!0;if(!this.createdOn)return!0;var e=c.safeParseInt(this.expiresIn);return e<=0||!((new Date).getTime()-this.createdOn<1e3*e)},e.prototype.applyTo=function(e){var t=this;e.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer ".concat(t.token))}},e.prototype.applyToV2=function(e){e.headers=e.headers||{},e.headers={Authorization:"Bearer ".concat(this.token)}},e.prototype.applyToV3=function(e){e.requestheaders=e.requestheaders||[],e.requestheaders.push({key:"Authorization",value:"Bearer ".concat(this.token)})},e.prototype.reset=function(){n.prototype.reset.call(this),this.refreshToken="",this.expiresIn=null,this.createdOn=null},e}(D);var q=function(t){function e(){var e=t.call(this,S)||this;return e._openId="",e}return m(e,t),e.prototype.persistent=function(){var e=t.prototype.persistent.call(this);return b({},e,{openId:this._openId})},e.prototype.readFrom=function(e){return t.prototype.readFrom.call(this,e),this._openId=e.openId,this},e}(M),U=function(){function e(){}return e.prototype.getTokenInternal=function(){throw new Error("NotImplemented")},e.prototype.applyTo=function(e){},e.prototype.isExpired=function(){return!1},e.prototype.readFrom=function(e){},e.prototype.persistent=function(){},e.prototype.applyToV2=function(e){},e.prototype.applyToV3=function(e){},e.prototype.getTokenP=function(){throw new Error("NotImplemented")},e.prototype.reset=function(){},e}(),V=t.underscore;var B=function(){function e(e){this.authPolicy=e,this._user={},this._security=e}return Object.defineProperty(e.prototype,"asObservable",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.security=function(e){return e&&(this._security=e),this._security},e.prototype.readFrom=function(e){this._user=V.extend(this._user,e)},e.prototype.setUser=function(e){(function a(e,t){if(e===t)return!0;if(null===e||null===t)return e===t;if("object"!=typeof e||"object"!=typeof t)return e===t;if(c.isArray(t)&&c.isArray(e)){if(e.length!==t.length)return!1;for(var n=e.length;n--;)if(!a(e[n],t[n]))return!1}var r={},o=t;for(var n in o)if(o.hasOwnProperty(n)){if(!a(e[n],t[n]))return!1;r[n]=!0}var i=e;for(var n in i)if(i.hasOwnProperty(n)&&!r[n]&&!a(e[n],t[n]))return!1;return!0})(this._user,e)||(this._user=e,this.asObservable.fire("change:user",{data:this._user}))},e.prototype.extendUser=function(e){var t=V.extend({},this._user,e);this.setUser(t)},e.prototype.getUser=function(){return V.extend({},this._user)},e.prototype.subscribe=function(e,t){(void 0===t&&(t=!1),this.asObservable.on("change:user",e),t)&&e({data:this._user})},e.prototype.unSubscribe=function(e){this.asObservable.off("change:user",e)},e.prototype.isUserKnown=function(){return!(!this._user||!this._user.username)},e.prototype.isAuthenticated=function(){return this.authPolicy&&!this.authPolicy.isExpired()},e=P([T,w("design:paramtypes",[Object])],e)}(),G=t.jquery;var H=function(n){function e(e){var t=n.call(this,e)||this;return t._antiForgeryKey=e.antiForgeryKey||"__RequestVerificationToken",t._elementTag=e.elementTag||"",t._expired=!0,t}return m(e,n),e.prototype.isExpired=function(){return this._expired},e.prototype.inputField=function(){return'input[name="'+this._antiForgeryKey+'"]'},e.prototype.readFrom=function(e){this.token=e.token},e.prototype.persistent=function(){return{token:this.token}},e.prototype.getTokenInternal=function(){var e=function t(e,o,i){return G.ajax({url:e,dataType:"html text"}).then(function(e){var t,n,r;return n="",t=(new DOMParser).parseFromString(e,"text/html"),o?0<(r=G(t).find(o)).length&&0<(r=G(t).find(i)).length&&(n=(r=r.eq(0)).attr("value")):0<(r=G(t).find(i)).length&&(n=(r=r.eq(0)).attr("value")),n})}(this.url,this._elementTag,this.inputField());c.liftWithGuard(e,function(e){var t=e&&0<e.length;return this._expired=!t,t});return e},e.prototype.applyTo=function(e){e.data[this._antiForgeryKey]=this.token},e.prototype.applyToV2=function(e){e.params=e.params||{},e.params[this._antiForgeryKey]=this.token},e.prototype.applyToV3=function(e){},e.prototype.reset=function(){n.prototype.reset.call(this),this._expired=!0},e}(D),J=function(r){function e(e,t){var n=r.call(this,e)||this;return n._payload=b({},t),n}return m(e,r),Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),e.prototype.getParams=function(){var e=r.prototype.getParams.call(this);return b({},e,this._payload)},e}(M);function L(e,n){switch(n.type){case"ADD":var t=n.payload.filter(function(t){return-1===e.items.findIndex(function(e){return t.id===e.id})});return b({},e,{items:function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(x(arguments[t]));return e}(e.items,t)});case"REMOVE":var r=e.items.filter(function(t){return-1===n.payload.findIndex(function(e){return t.id===e.id})});return b({},e,{items:r});case"MODIFY":default:return e}}function z(){return{collection:{items:[]}}}function W(){return{collection:L}}function Y(){var e=new i.ActionsSubject,t=new i.ScannedActionsSubject,n=i.combineReducers,r=new i.ReducerManager(e,{collection:{items:[]}},W(),n),o=new i.State(e,r,t,{collection:{items:[]}});return new i.Store(o,e,r)}var X=function(){function e(){}return e.prototype.add=function(e){this.getStore().dispatch({type:"ADD",payload:e})},e.prototype.remove=function(e){this.getStore().dispatch({type:"REMOVE",payload:e})},e.prototype.modify=function(e){this.getStore().dispatch({type:"MODIFY",payload:e})},e}(),Q=function(t){function e(){var e=t.call(this)||this;return e._store=Y(),e}return m(e,t),e.prototype.getStore=function(){return this._store},e.prototype.getState=function(){return this._store.select("collection")},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(X),Z=t.when,$=t.underscore;var ee=function(){function e(e){this._providerGenerator=e,this._workingProviders=[]}return e.prototype.hasNextPage=function(){return 0===this._workingProviders.length||(!!this._providerGenerator.hasMore()||$.some(this._workingProviders,function(e){return e.hasNextPage()}))},e.prototype.getFirstPage=function(){var n=this;return this._providerGenerator.getNext().then(function(e){return e=$.filter(e,function(e){return function t(e){return!e.state.totalPages&&!e.state.totalRecords||e.hasNextPage()}(e)})}).then(function(e){n._workingProviders.length=0;var t=$.map(e,function(t){var n=this;return function r(e){return e.state.totalPages||e.state.totalRecords?e.getNextPage():e.getFirstPage()}(t).then(function(e){return n._workingProviders.push(t),e})});return Z.settle(t)})},e.prototype.getNextPage=function(){return this.getFirstPage()},e.prototype.reset=function(){this._providerGenerator.reset(),this._workingProviders=[]},e.prototype.forEach=function(t){this._workingProviders.forEach(function(e){e.forEach(t)})},e.prototype.get=function(e){},e}(),te=t.backbone,ne=t.meld;function re(e){return ne.before(te,"sync",e)}function oe(e){return ne.around(te,"sync",e)}function ie(e){return ne.before(te,"ajax",e)}var ae=t.dataflow,se=t.backbone,ce=t.underscore,ue={model:1,collection:2,pagedCollection:3},pe={read:"read",create:"create",patch:"patch",update:"update","delete":"delete"},fe={},le=[];var he=function(){function e(e){this._cache=new F(300),this._dataflow=new ae,this._myEndPointKeys=[],this._host=e.webhost||"",this._uniqueNamePrefix=this._host?this._host.replace(".","-")+"-":"",function t(){if(!(0<le.length)){var e=re(function(e,t,n){if(n.methodKey=e,n.endPointKey=t.endPointKey||(t.collection?t.collection.endPointKey:null),n.endPointKey){var r=fe[n.endPointKey].options;"delete"===e?(r.deleteUrl&&(n.url=r.deleteUrl),r.deleteContentType&&(n.contentType=r.deleteContentType)):"update"===e?(r.updateUrl&&(n.url=r.updateUrl),r.updateContentType&&(n.contentType=r.updateContentType)):"create"===e?(r.createUrl&&(n.url=r.createUrl),r.createContentType&&(n.contentType=r.createContentType)):"patch"===e&&(r.patchUrl&&(n.url=r.patchUrl),r.patchContentType&&(n.contentType=r.patchContentType))}});le.push(e),e=ie(function(e){if(e.endPointKey){var t=fe[e.endPointKey].options,n=t.securityDelegate,r=t.extraParams;"application/x-www-form-urlencoded"===t.contentType&&"application/json"===e.contentType?(e.data=JSON.parse(e.data),r&&ce.extend(e.data,r),n&&n(e),e.data=c.urlEncode(e.data),e.contentType=t.contentType):(r&&ce.extend(e.data,r),n&&n(e),"application/x-www-form-urlencoded"===e.contentType&&(e.data=c.urlEncode(e.data)))}}),le.push(e),e=oe(function(e){var t=e.args[2];if(t.endPointKey){var n=fe[t.endPointKey],r=n.options;if(r.syncDelegate)return(0,r.syncDelegate)(t.endPointKey,t,n,function(){return e.proceed()})}return e.proceed()}),le.push(e)}}()}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configurationMapping",{get:function(){return fe},enumerable:!0,configurable:!0}),e.prototype.addEndPoint=function(e,t,n){var r=this.configurationMapping,o=this._dataflow,i=this._uniqueNamePrefix+e;if(r[i])throw new Error("Redefined endpoint: "+e);if(r[i]={options:ce.extend(n,{endPointKey:i}),tag:t},this._myEndPointKeys.push(i),t===ue.model)for(var a in pe){if(pe.hasOwnProperty(a))o[e+":"+pe[a]]=1}else o[e+":"+pe.read]=1},e.prototype.getEndPoint=function(e,t){var n=this._cache,r=this._uniqueNamePrefix+e;if(!0!==t){var o=n.get(r);if(o)return o}var i=this.configurationMapping[r];if(!i)throw new Error("No given endpoint is defined for: "+e);var a=null;if(i.tag===ue.model)a=se.Model.extend(i.options);else if(i.tag===ue.collection)a=se.Collection.extend(i.options);else{if(i.tag!==ue.pagedCollection)throw new Error("Not implemented");a=se.PageableCollection.extend(i.options)}return!0!==t&&n.set(r,a,300),a},e.prototype.getConfiguration=function(e){var t=this._uniqueNamePrefix+e;return this.configurationMapping[t]},e.prototype.addWhenCallback=function(e,t){this._dataflow.when(e,t)},e.prototype.addDependency=function(e,t){var n=this._dataflow;n.on(e,function(){n[t]=n[t]+1})},e.prototype.cleanupCache=function(){this._cache.reset()},e.prototype.cleanMountedFeatures=function(){le.forEach(function(e){e.remove()}),le.length=0},e.prototype.destroy=function(){this._myEndPointKeys.forEach(function(e){delete fe[e]}),this._myEndPointKeys.length=0,this._cache.destroy(),this._cache=null,this._dataflow=null,this._host=null,this._uniqueNamePrefix=null},e}(),de=window.localStorage,ye=t.underscore,ve=ye.find,ge=ye.findIndex,_e=ye.union;function me(e,t){var n=c.defaultValue(t);try{var r=de.getItem(e);r&&"undefined"!==r&&(r=JSON.parse(r),c.ok(r,t)&&(n=r))}catch(o){console.log(o)}return n}function be(e,t,n){void 0===n&&(n=null);try{de.setItem(e,JSON.stringify(t))}catch(r){console.log(r)}}function Pe(e,t){try{de.setItem(e,JSON.stringify(c.defaultValue(t)))}catch(n){console.log(n)}}var we=function(){function e(){}return e.prototype.getP=function(e){var t=me(e,c.tyObject);return c.lift(t,null)},e.prototype.removeP=function(e){return Pe(e,c.tyObject),c.lift(!0,null)},e.prototype.updateP=function(e,t){return be(e,t,c.tyObject),c.lift(!0,null)},e}(),xe=t.I18n,Oe=function(){function e(){}return e.getDictByCode=function(e){return xe.data[e]},e.add=function(e,t){xe.add(e,t)},e.translate=function(e,t){var n=xe.translate(e);return n===e&&t?t:n},e.recycleOthers=function(e){var t=xe.data,n=[];for(var r in t)t.hasOwnProperty(r)&&r!==e&&n.push(r);for(var o=0;o<n.length;o++){delete t[n[o]]}},e}();t.underscore.isString;function Ee(e,t,n){void 0===n&&(n=1);var r=t.slice(n).join(".");if(e[r])return e[r];for(var o=e,i=n;i<t.length&&o;i++){o=o[t[i]]}return o}var ke=function(){function e(e){void 0===e&&(e=null),this._cache=e,this._configuration={}}return e.prototype.register=function(e,t,n){void 0===n&&(n=60);var r=this._configuration;if(r[e])throw new Error("Registering an existing resource key: "+e);r[e]={uri:t,liveSeconds:n}},e.prototype.undoRegister=function(e){var t=this._configuration;t[e]&&delete t[e]},e.prototype.getPromise=function(e,t){var n=e.split("."),r=n[0],o=this._cache;if(o){var i=o.get(r,60);if(i){var a=Ee(i,n);if(a)return c.lift(a,null)}}var s=this._configuration[r];if(!s)throw new Error("Get unregistered resource: "+r);return g(s.uri).then(function(e){return e=t(e),o&&o.set(r,e,s.liveSeconds),Ee(e,n)})},e}();e.RelationalTable=r,e.DummyRecords=p,e.RelationDatabase=f,e.sendPromise=function Te(e){var t=h.extend({},d,e);return new Promise(function(r,o){var e={url:t.url,content_type:t.content_type,response_type:t.response_type,type:t.type,data:t.data,async:t.async,success:function(e,t,n){r({response:e,xhr:t,settings:n})},error:function(e,t,n){o({error:e,xhr:t,settings:n})},success_scope:t.success_scope,error_scope:t.error_scope,scope:t.scope,requestheaders:t.requestheaders};"application/x-www-form-urlencoded"===t.content_type?e.data=c.urlEncode(e.data):"application/json"===t.content_type&&(e.data=JSON.stringify(e.data)),l.send(e)})},e.loadJsonUriP=g,e.pingP=function Re(e,t){t=t||{};var n=y.extend({url:e},t);return v.ajax(n)},e.loadHtmlP=function Ie(e){return v.ajax({url:e,dataType:"html text"}).then(function(e){var t=(new DOMParser).parseFromString(e,"text/html");return v(t)})},e.SlidingExpirationCache=F,e.MemoryBackend=O,e.adaptToOpenIDToken=function je(e){var t=K(e=e||{});return b({},t,{openId:e.openId||""})},e.OpenIDPolicy=q,e.PolicyBase=D,e.NullPolicy=U,e.UserCredential=B,e.AntiForgeryKeyPolicy=H,e.adaptToOAuthToken=K,e.OAuthTokenExtPolicy=J,e.OAuthTokenPolicy=M,e.DummyOAuthTokenCtorParams=S,e.observableDecorator=T,e.factory=Y,e.CollectionStore=Q,e.CollectionAbstractStore=X,e.reducer=L,e.buildInitialState=z,e.buildReducerMap=W,e.AggregateCollection=ee,e.mountSyncListener=function Ce(e){return[ne.before(te.Collection.prototype,"trigger",e),ne.before(te.Model.prototype,"trigger",e)]},e.mountSyncBeforeAdvice=re,e.mountSyncAroundAdvice=oe,e.mountAjaxBeforeAdvice=ie,e.endPointEnum=ue,e.syncMethodEnum=pe,e.GlobalProvider=he,e.getEntity=me,e.updateEntity=be,e.cleanEntity=Pe,e.insertEntities=function Fe(e,t,n){var r=me(e,c.tyArray);be(e,0<n&&r.length>n?t:_e(r,t),c.tyArray)},e.findEntityById=function Se(e,t){var n=me(e,c.tyArray);return ve(n,{Id:t})},e.removeEntityById=function Ae(e,t){var n=me(e,c.tyArray),r=ge(n,{Id:t});-1!==r&&(n.splice(r,1),be(e,n,c.tyArray))},e.insertOrUpdateEntity=function De(e,t){var n=me(e,c.tyArray),r=ge(n,{Id:t.Id});-1!==r?n[r]=t:n.push(t),be(e,n,c.tyArray)},e.cleanEntityGroup=function Ne(e){var t=[];for(var n in de)de.hasOwnProperty(n)&&0===n.indexOf(e)&&t.push(n);return 0===t.length||t.forEach(function(e){de.removeItem(e)}),t},e.LocalStorageTable=we,e.I18n=Oe,e.ResourceLoader=ke,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polpware-fe-data.umd.min.js.map